/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-langx-hoster/isBrowser","skylark-domx-geom","skylark-domx-styler","skylark-domx-scrolls/scrollingElement"],function(l,e,o,t,r){"use strict";var i,n,a,c=[],s=!1,f=null,v=e&&e.ie,u=e&&e.edge,d=(e&&e.firefox,e&&e.safari);var h,g=function(l,e){if(!l||!l.getBoundingClientRect)return r();var o=l,i=!1;do{if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var n=t.css(o);if(o.clientWidth<o.scrollWidth&&("auto"==n.overflowX||"scroll"==n.overflowX)||o.clientHeight<o.scrollHeight&&("auto"==n.overflowY||"scroll"==n.overflowY)){if(!o||!o.getBoundingClientRect||o===document.body)return r();if(i||e)return o;i=!0}}}while(o=o.parentNode);return r()},b=w(function(l,e,a,v,u){if(e.scroll){var d=a?a[u]:window,h=e.scrollSensitivity,b=e.scrollSpeed,w=l.clientX,m=l.clientY,p=r(),x=!1;f!==a&&(y(),i=e.scroll,n=e.scrollFn,!0===i&&(i=g(a,!0),f=i));var S=0,k=i;do{var X,Y,_,E,P,I,R,H,M,W=k,B=o.boundingRect(W),T=B.top,F=B.bottom,A=B.left,C=B.right,L=B.width,N=B.height;if(X=W.scrollWidth,Y=W.scrollHeight,_=t.css(W),H=W.scrollLeft,M=W.scrollTop,W===p?(I=L<X&&("auto"===_.overflowX||"scroll"===_.overflowX||"visible"===_.overflowX),R=N<Y&&("auto"===_.overflowY||"scroll"===_.overflowY||"visible"===_.overflowY)):(I=L<X&&("auto"===_.overflowX||"scroll"===_.overflowX),R=N<Y&&("auto"===_.overflowY||"scroll"===_.overflowY)),E=I&&(Math.abs(C-w)<=h&&H+L<X)-(Math.abs(A-w)<=h&&!!H),P=R&&(Math.abs(F-m)<=h&&M+N<Y)-(Math.abs(T-m)<=h&&!!M),!c[S])for(var O=0;O<=S;O++)c[O]||(c[O]={});c[S].vx==E&&c[S].vy==P&&c[S].el===W||(c[S].el=W,c[S].vx=E,c[S].vy=P,clearInterval(c[S].pid),!W||0==E&&0==P||(x=!0,c[S].pid=setInterval(function(){v&&0===this.layer&&(Sortable.active._emulateDragOver(!0),Sortable.active._onTouchMove(touchEvt,!0));var e=c[this.layer].vy?c[this.layer].vy*b:0,t=c[this.layer].vx?c[this.layer].vx*b:0;"function"==typeof n&&"continue"!==n.call(d,t,e,l,touchEvt,c[this.layer].el)||o.scrollBy(c[this.layer].el,t,e)}.bind({layer:S}),24))),S++}while(e.bubbleScroll&&k!==p&&(k=g(k,!1)));s=x}},30),y=function(){c.forEach(function(l){clearInterval(l.pid)}),c=[]};function w(e,o){return l.debounce(e,o)}return{autoScrolls:c,_isScrolledPast:function(l,e){for(var t=g(l,!0),i=o.boundingRect(l)[e];t;){var n=o.boundingRect(t)[e];if(!("top"===e||"left"===e?i>=n:i<=n))return t;if(t===r())break;t=g(t,!1)}return!1},_getRelativeScrollOffset:function(l){var e=0,o=0,t=r();if(l)do{var i=transforms.matrix(l),n=i.a,a=i.d;e+=l.scrollLeft*n,o+=l.scrollTop*a}while(l!==t&&(l=l.parentNode));return[e,o]},_autoScroll:b,_clearAutoScrolls:y,_handleAutoScroll:function(l,e,o){var t=l.clientX,i=l.clientY,n=document.elementFromPoint(t,i);if(o||u||v||d){h=b(l,e,n,o);var c=g(n,!0);!s||a&&t===lastPointerElemX&&i===lastPointerElemY||(a&&clearInterval(a),a=setInterval(function(){if(dragEl){var r=g(document.elementFromPoint(t,i),!0);r!==c&&(c=r,y(),h=b(l,e,c,o))}},10),lastPointerElemX=t,lastPointerElemY=i)}else{if(!e.bubbleScroll||g(n,!0)===r())return void y();h=b(l,e,g(n,!1),!1)}},_throttle:w,_cancelThrottle:function(){h&&h.stop&&(h.stop(),h=void 0)},_nulling:function(){a&&clearInterval(a),a=null}}});
//# sourceMappingURL=sourcemaps/autoscroll.js.map
