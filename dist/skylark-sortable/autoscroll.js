/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-langx-hoster/isBrowser","skylark-domx-geom","skylark-domx-styler","skylark-domx-scrolls/scrollingElement"],function(l,e,o,r,t){"use strict";var i,n,c,a=[],s=!1,f=null,v=e&&e.ie,u=e&&e.edge,d=(e&&e.firefox,e&&e.safari);var h,g=function(l,e){if(!l||!l.getBoundingClientRect)return t();var o=l,i=!1;do{if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var n=r.css(o);if(o.clientWidth<o.scrollWidth&&("auto"==n.overflowX||"scroll"==n.overflowX)||o.clientHeight<o.scrollHeight&&("auto"==n.overflowY||"scroll"==n.overflowY)){if(!o||!o.getBoundingClientRect||o===document.body)return t();if(i||e)return o;i=!0}}}while(o=o.parentNode);return t()},b=w(function(l,e,c,v,u){if(e.scroll){var d=c?c[u]:window,h=e.scrollSensitivity,b=e.scrollSpeed,w=l.clientX,m=l.clientY,p=t(),x=!1;f!==c&&(y(),i=e.scroll,n=e.scrollFn,!0===i&&(i=g(c,!0),f=i));var S=0,k=i;do{var X,Y,_,E,P,I,R,H,W,B=k,T=o.boundingRect(B),F=T.top,A=T.bottom,C=T.left,L=T.right,N=T.width,O=T.height;if(X=B.scrollWidth,Y=B.scrollHeight,_=r.css(B),H=B.scrollLeft,W=B.scrollTop,B===p?(I=N<X&&("auto"===_.overflowX||"scroll"===_.overflowX||"visible"===_.overflowX),R=O<Y&&("auto"===_.overflowY||"scroll"===_.overflowY||"visible"===_.overflowY)):(I=N<X&&("auto"===_.overflowX||"scroll"===_.overflowX),R=O<Y&&("auto"===_.overflowY||"scroll"===_.overflowY)),E=I&&(abs(L-w)<=h&&H+N<X)-(abs(C-w)<=h&&!!H),P=R&&(abs(A-m)<=h&&W+O<Y)-(abs(F-m)<=h&&!!W),!a[S])for(var D=0;D<=S;D++)a[D]||(a[D]={});a[S].vx==E&&a[S].vy==P&&a[S].el===B||(a[S].el=B,a[S].vx=E,a[S].vy=P,clearInterval(a[S].pid),!B||0==E&&0==P||(x=!0,a[S].pid=setInterval(function(){v&&0===this.layer&&(Sortable.active._emulateDragOver(!0),Sortable.active._onTouchMove(touchEvt,!0));var e=a[this.layer].vy?a[this.layer].vy*b:0,r=a[this.layer].vx?a[this.layer].vx*b:0;"function"==typeof n&&"continue"!==n.call(d,r,e,l,touchEvt,a[this.layer].el)||o.scrollBy(a[this.layer].el,r,e)}.bind({layer:S}),24))),S++}while(e.bubbleScroll&&k!==p&&(k=g(k,!1)));s=x}},30),y=function(){a.forEach(function(l){clearInterval(l.pid)}),a=[]};function w(e,o){return l.debounce(e,o)}return{autoScrolls:a,_isScrolledPast:function(l,e){for(var r=g(l,!0),i=o.boundingRect(l)[e];r;){var n=o.boundingRect(r)[e];if(!("top"===e||"left"===e?i>=n:i<=n))return r;if(r===t())break;r=g(r,!1)}return!1},_getRelativeScrollOffset:function(l){var e=0,o=0,r=t();if(l)do{var i=transforms.matrix(l),n=i.a,c=i.d;e+=l.scrollLeft*n,o+=l.scrollTop*c}while(l!==r&&(l=l.parentNode));return[e,o]},_autoScroll:b,_clearAutoScrolls:y,_handleAutoScroll:function(l,e,o){var r=l.clientX,i=l.clientY,n=document.elementFromPoint(r,i);if(o||u||v||d){h=b(l,e,n,o);var a=g(n,!0);!s||c&&r===lastPointerElemX&&i===lastPointerElemY||(c&&clearInterval(c),c=setInterval(function(){if(dragEl){var t=g(document.elementFromPoint(r,i),!0);t!==a&&(a=t,y(),h=b(l,e,a,o))}},10),lastPointerElemX=r,lastPointerElemY=i)}else{if(!e.bubbleScroll||g(n,!0)===t())return void y();h=b(l,e,g(n,!1),!1)}},_throttle:w,_cancelThrottle:function(){h&&h.stop&&(h.stop(),h=void 0)},_nulling:function(){c&&clearInterval(c),c=null}}});
//# sourceMappingURL=sourcemaps/autoscroll.js.map
