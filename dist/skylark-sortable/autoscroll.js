/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-langx-hoster/isBrowser","skylark-domx-geom","skylark-domx-styler","skylark-domx-scrolls/scrollingElement","./dnd"],function(l,e,o,r,t,n){var i=[],a=!1,c=null,s=e&&e.ie,v=e&&e.edge,f=(e&&e.firefox,e&&e.safari);var u,d=function(l,e){if(!l||!l.getBoundingClientRect)return t();var o=l,n=!1;do{if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var i=r.css(o);if(o.clientWidth<o.scrollWidth&&("auto"==i.overflowX||"scroll"==i.overflowX)||o.clientHeight<o.scrollHeight&&("auto"==i.overflowY||"scroll"==i.overflowY)){if(!o||!o.getBoundingClientRect||o===document.body)return t();if(n||e)return o;n=!0}}}while(o=o.parentNode);return t()},h=m(function(l,e,s,v){if(e.scroll){var f=s?s[n.expando]:window,u=e.scrollSensitivity,h=e.scrollSpeed,m=l.clientX,b=l.clientY,y=t(),w=!1;c!==s&&(g(),scrollEl=e.scroll,scrollCustomFn=e.scrollFn,!0===scrollEl&&(scrollEl=d(s,!0),c=scrollEl));var p=0,E=scrollEl;do{var x,S,k,X,Y,C,I,_,P,F=E,R=o.boundingRect(F),H=R.top,W=R.bottom,B=R.left,T=R.right,A=R.width,L=R.height;if(x=F.scrollWidth,S=F.scrollHeight,k=r.css(F),_=F.scrollLeft,P=F.scrollTop,F===y?(C=A<x&&("auto"===k.overflowX||"scroll"===k.overflowX||"visible"===k.overflowX),I=L<S&&("auto"===k.overflowY||"scroll"===k.overflowY||"visible"===k.overflowY)):(C=A<x&&("auto"===k.overflowX||"scroll"===k.overflowX),I=L<S&&("auto"===k.overflowY||"scroll"===k.overflowY)),X=C&&(abs(T-m)<=u&&_+A<x)-(abs(B-m)<=u&&!!_),Y=I&&(abs(W-b)<=u&&P+L<S)-(abs(H-b)<=u&&!!P),!i[p])for(var N=0;N<=p;N++)i[N]||(i[N]={});i[p].vx==X&&i[p].vy==Y&&i[p].el===F||(i[p].el=F,i[p].vx=X,i[p].vy=Y,clearInterval(i[p].pid),!F||0==X&&0==Y||(w=!0,i[p].pid=setInterval(function(){v&&0===this.layer&&(Sortable.active._emulateDragOver(!0),Sortable.active._onTouchMove(touchEvt,!0));var e=i[this.layer].vy?i[this.layer].vy*h:0,r=i[this.layer].vx?i[this.layer].vx*h:0;"function"==typeof scrollCustomFn&&"continue"!==scrollCustomFn.call(f,r,e,l,touchEvt,i[this.layer].el)||o.scrollBy(i[this.layer].el,r,e)}.bind({layer:p}),24))),p++}while(e.bubbleScroll&&E!==y&&(E=d(E,!1)));a=w}},30),g=function(){i.forEach(function(l){clearInterval(l.pid)}),i=[]};function m(e,o){return l.debounce(e,o)}return{autoScrolls:i,_isScrolledPast:function(l,e){for(var r=d(l,!0),n=o.boundingRect(l)[e];r;){var i=o.boundingRect(r)[e];if(!("top"===e||"left"===e?n>=i:n<=i))return r;if(r===t())break;r=d(r,!1)}return!1},_getRelativeScrollOffset:function(l){var e=0,o=0,r=t();if(l)do{var n=transforms.matrix(l),i=n.a,a=n.d;e+=l.scrollLeft*i,o+=l.scrollTop*a}while(l!==r&&(l=l.parentNode));return[e,o]},_autoScroll:h,_clearAutoScrolls:g,_handleAutoScroll:function(l,e,o){var r=l.clientX,n=l.clientY,i=document.elementFromPoint(r,n);if(o||v||s||f){u=h(l,e,i,o);var c=d(i,!0);!a||pointerElemChangedInterval&&r===lastPointerElemX&&n===lastPointerElemY||(pointerElemChangedInterval&&clearInterval(pointerElemChangedInterval),pointerElemChangedInterval=setInterval(function(){if(dragEl){var t=d(document.elementFromPoint(r,n),!0);t!==c&&(c=t,g(),u=h(l,e,c,o))}},10),lastPointerElemX=r,lastPointerElemY=n)}else{if(!e.bubbleScroll||d(i,!0)===t())return void g();u=h(l,e,d(i,!1),!1)}},_throttle:m,_cancelThrottle:function(){u&&u.stop&&(u.stop(),u=void 0)}}});
//# sourceMappingURL=sourcemaps/autoscroll.js.map
