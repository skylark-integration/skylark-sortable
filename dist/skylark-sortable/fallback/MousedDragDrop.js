/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-query","skylark-domx-eventer","skylark-domx-styler","skylark-domx-finder","skylark-domx-transforms","skylark-domx-plugins-scrolls/auto-scroll","./ghoster"],function(t,e,l,n,o,r,a,i){"use strict";return t.Emitter.inherit({_construct:function(t){this.dnd=t;var l=e(document);this.listenTo(l,"mousemove",this._onMouseMove),this.listenTo(l,"mouseup",this._onMouseUp)},_onMouseUp:function(t){var e=this.dnd;e.putSortable&&e.putSortable.droppable._onDrop(t),e.dragging&&e.dragging._onDragEnd(t),i.remove(),this.destroy()},_onMouseMove:function(t){var e=this.dnd,l=i.ghostEl,o=e.dragging,a=e.dragEl,s=e.tapEvt;if(s){var h=o.options,d=h.fallbackTolerance,c=h.fallbackOffset,u=l&&r.matrix(l),m=l&&u&&u.a,v=l&&u&&u.d,g=i.getRelativeScrollOffset(),p=(t.clientX-s.clientX+c.x)/(m||1)+(g?g[0]-ghostRelativeParentInitialScroll[0]:0)/(m||1),f=(t.clientY-s.clientY+c.y)/(v||1)+(g?g[1]-ghostRelativeParentInitialScroll[1]:0)/(v||1),_=t.touches?"translate3d("+p+"px,"+f+"px,0)":"translate("+p+"px,"+f+"px)";if(!this._dragStarted&&!e.awaitingDragStarted){if(d&&Math.min(Math.abs(t.clientX-o._lastX),Math.abs(t.clientY-o._lastY))<d)return;o._onDragStart(t,!0),i._appendGhost(a,document.body,o.options),this._dragStarted=!0,this._loopId=setInterval(this._emulateDragOver.bind(this),50)}this._handleAutoScroll(t,!0),this.touchEvt=t,l&&n.css(l,"transform",_),t.preventDefault()}},_emulateDragOver:function(t){var e=this.dnd,l=(e.dragEl,this.touchEvt);if(l){if(this._lastX===l.clientX&&this._lastY===l.clientY&&!t)return;this._lastX=l.clientX,this._lastY=l.clientY;for(var n=document.elementFromPoint(l.clientX,l.clientY),o=n;n&&n.shadowRoot&&(n=n.shadowRoot.elementFromPoint(l.clientX,l.clientY))!==o;)o=n;if(o)do{if(o[e.expando])if(o[e.expando].droppable._onDragOver({clientX:l.clientX,clientY:l.clientY,target:n,rootEl:o}))break;n=o}while(o=o.parentNode)}},_handleAutoScroll:function(t,e){var l=this.dnd;if(l.dragEl&&l.active.options.scroll){var n=t.clientX,r=t.clientY;document.elementFromPoint(n,r);if(!this.pointerElemChangedInterval||n!==this.lastPointerElemX||r!==this.lastPointerElemY){this.pointerElemChangedInterval&&clearInterval(this.pointerElemChangedInterval);var i=null;this.pointerElemChangedInterval=setInterval(function(){var t=o.scrollableParent(document.elementFromPoint(n,r),!0);t!==i&&(i=t,this.autoscroller&&(this.autoscroller.destroy(),this.autoscroller=null),this.autoscroller=new a(i,l.active.options),this.autoscroller.handle(n,r))},10),this.lastPointerElemX=n,this.lastPointerElemY=r}}},destroy:function(){this.unlistenTo(),this._loopId&&clearInterval(this._loopId),this.pointerElemChangedInterval&&clearInterval(this.pointerElemChangedInterval),this.autoscroller&&(this.autoscroller.destroy(),this.autoscroller=null),this._dragStarted=!1}})});
//# sourceMappingURL=../sourcemaps/fallback/MousedDragDrop.js.map
