/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-query","skylark-domx-eventer","skylark-domx-styler","skylark-domx-transforms","./ghoster","./autoscroll"],function(t,e,o,n,l,a,i){return t.Emitter.inherit({_construct:function(t){this.dnd=t;var o=e(document);this.listenTo(o,"mousemove",this._onTouchMove.bind(this)),this.listenTo(o,"mouseup",this._onMouseUp.bind(this))},_onMouseUp:function(t){var e=this.dnd;e.putSortable&&e.putSortable._onDrop(t),e.draggable&&e.draggable._onDragEnd(t),a.remove(),this.destroy()},_onTouchMove:function(t,e){var o=this.dnd,i=a.ghostEl,r=o.draggable,s=r.dragEl,c=o.tapEvt;if(c){var d=r.options,h=d.fallbackTolerance,u=d.fallbackOffset,g=t.touches?t.touches[0]:t,p=i&&l.matrix(i),_=i&&p&&p.a,f=i&&p&&p.d,v=a.getRelativeScrollOffset(),m=(g.clientX-c.clientX+u.x)/(_||1)+(v?v[0]-ghostRelativeParentInitialScroll[0]:0)/(_||1),b=(g.clientY-c.clientY+u.y)/(f||1)+(v?v[1]-ghostRelativeParentInitialScroll[1]:0)/(f||1),x=t.touches?"translate3d("+m+"px,"+b+"px,0)":"translate("+m+"px,"+b+"px)";if(!o.active&&!o.awaitingDragStarted){if(h&&Math.min(Math.abs(g.clientX-r._lastX),Math.abs(g.clientY-r._lastY))<h)return;r._onDragStart(t,!0),a._appendGhost(s,document.body,r.options),o.ignoreNextClick=!0,this._loopId=setInterval(this._emulateDragOver.bind(this),50)}!e&&this._handleAutoScroll(g,!0),o.touchEvt=g,i&&n.css(i,"transform",x),t.preventDefault()}},_emulateDragOver:function(t){var e=this.dnd,o=e.draggable.dragEl,n=e.touchEvt;if(n){if(this._lastX===n.clientX&&this._lastY===n.clientY&&!t)return;this._lastX=n.clientX,this._lastY=n.clientY;for(var l=document.elementFromPoint(n.clientX,n.clientY),a=l;l&&l.shadowRoot&&(l=l.shadowRoot.elementFromPoint(n.clientX,n.clientY))!==a;)a=l;if(a)do{if(a[e.expando])if(a[e.expando]._onDragOver({clientX:n.clientX,clientY:n.clientY,target:l,rootEl:a}))break;l=a}while(a=a.parentNode);o.parentNode[e.expando]._computeIsAligned(n)}},_handleAutoScroll:function(t,e){var o=this.dnd;if(o.draggable.dragEl&&o.draggable.options.scroll)return i._handleAutoScroll(t,o.draggable.options,e,o.expando)},destroy:function(){this.unlistenTo(),this._loopId&&clearInterval(this._loopId),i._nulling(),i._clearAutoScrolls(),i._cancelThrottle()}})});
//# sourceMappingURL=../sourcemaps/fallback/MousedDragDrop.js.map
