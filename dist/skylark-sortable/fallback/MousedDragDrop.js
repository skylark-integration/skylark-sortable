/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-query","skylark-domx-eventer","skylark-domx-styler","skylark-domx-transforms","./ghoster"],function(t,e,n,o,a,i){return t.Emitter.inherit({_construct:function(t){this.dnd=t;var n=e(document);this.listenTo(n,"mousemove",this._onTouchMove.bind(this)),this.listenTo(n,"mouseup",this._onMouseUp.bind(this))},_onMouseUp:function(t){var e=this.dnd;e.putSortable&&e.putSortable._onDrop(t),e.draggable&&e.draggable._onDragEnd(t),i.remove(),this.destroy()},_onTouchMove:function(t,e){var n=this.dnd,l=i.ghostEl,r=n.draggable,s=r.dragEl,c=n.tapEvt;if(c){var d=r.options,h=d.fallbackTolerance,u=d.fallbackOffset,g=t.touches?t.touches[0]:t,f=l&&a.matrix(l),p=l&&f&&f.a,v=l&&f&&f.d,m=i.getRelativeScrollOffset(),_=(g.clientX-c.clientX+u.x)/(p||1)+(m?m[0]-ghostRelativeParentInitialScroll[0]:0)/(p||1),x=(g.clientY-c.clientY+u.y)/(v||1)+(m?m[1]-ghostRelativeParentInitialScroll[1]:0)/(v||1),b=t.touches?"translate3d("+_+"px,"+x+"px,0)":"translate("+_+"px,"+x+"px)";if(!n.active&&!n.awaitingDragStarted){if(h&&Math.min(Math.abs(g.clientX-r._lastX),Math.abs(g.clientY-r._lastY))<h)return;r._onDragStart(t,!0),i._appendGhost(s,document.body,r.options),n.ignoreNextClick=!0,this._loopId=setInterval(this._emulateDragOver.bind(this),50)}!e&&n._handleAutoScroll(g,!0),n.touchEvt=g,l&&o.css(l,"transform",b),t.preventDefault()}},_emulateDragOver:function(t){var e=this.dnd,n=e.draggable.dragEl,o=e.touchEvt;if(o){if(this._lastX===o.clientX&&this._lastY===o.clientY&&!t)return;this._lastX=o.clientX,this._lastY=o.clientY;for(var a=document.elementFromPoint(o.clientX,o.clientY),i=a;a&&a.shadowRoot&&(a=a.shadowRoot.elementFromPoint(o.clientX,o.clientY))!==i;)i=a;if(i)do{if(i[e.expando])if(i[e.expando]._onDragOver({clientX:o.clientX,clientY:o.clientY,target:a,rootEl:i}))break;a=i}while(i=i.parentNode);n.parentNode[e.expando]._computeIsAligned(o)}},destroy:function(){this.unlistenTo(),this._loopId&&clearInterval(this._loopId)}})});
//# sourceMappingURL=../sourcemaps/fallback/MousedDragDrop.js.map
