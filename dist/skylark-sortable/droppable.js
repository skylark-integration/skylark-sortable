/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx","skylark-domx-finder","skylark-domx-styler","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-devices-points/touch","./dnd"],function(e,t,n,a,r,i,o,l){var s,d,c,h=!1;function g(){h=!1}function v(e,n){return t.index(e,function(e){return!("TEMPLATE"===e.nodeName.toUpperCase()||e===l.cloneEl||n&&!t.matches(e,n))})}return class{constructor(e,t){this.sortable=e;var n=this.el=this._elm=e.elm();this.options=t,e.nativeDraggable&&(a.on(n,"dragover",this),a.on(n,"dragenter",this),a.on(n,"drop",this)),a.on(n,"selectstart",this)}_onMove(e,t,n,r,o,s,d,c){var h,g,v=e[l.expando],u=v.options.onMove;return h=a.create("move",{to:t,from:e,dragged:n,draggedRect:r,related:o||t,relatedRect:s||i.boundingRect(t),willInsertAfter:c,originalEvent:d}),e.dispatchEvent(h),u&&(g=u.call(v,h,d)),g}_onDragOver(e){var a,r,o,u,p,f,b,m=this._elm,_=e.target,E=this.options,C=E.group,w=l.active,k=l.activeGroup===C,x=E.sort,D=this.sortable,R=l.dragEl,y=l.active.elm(),S=l.putSortable,M=l.nextEl,T=l.oldIndex,P=l.oldDraggableIndex;if(!h){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),s=!0,_=t.closest(_,E.draggable,m,!0),R.contains(e.target)||_.animated)return L(!1);if(w&&!E.disabled&&(k?x||(o=!y.contains(R)):S===this||(this.lastPutMode=l.activeGroup.checkPull(this,w,R,e))&&C.checkPut(this,w,R,e))){var I=D._getDirection(e,_);if(a=i.boundingRect(R),o)return this._hideClone(),l.parentEl=y,M?y.insertBefore(R,M):y.appendChild(R),L(!0);var B=function(e){return t.lastChild(e,{ignoreHidden:!0,excluding:[]})}(m);if(!B||function(e,n,a){var r=i.boundingRect(t.lastChild(a,{ignoreHidden:!0,excluding:[]})),o="vertical"===n?e.clientY:e.clientX,l="vertical"===n?e.clientX:e.clientY,s="vertical"===n?r.bottom:r.right,d="vertical"===n?r.left:r.top,c="vertical"===n?r.right:r.bottom;return"vertical"===n?l>c+10||l<=c&&o>s&&l>=d:o>s&&l>d||o<=s&&l>c+10}(e,I,m)&&!B.animated){if(B&&m===e.target&&(_=B),_&&(r=i.boundingRect(_)),k?w._hideClone():w._showClone(this),!1!==this._onMove(y,m,R,a,_,r,e,!!_))return m.appendChild(R),l.parentEl=m,j(),L(!0)}else if(_&&_!==R&&_.parentNode===m){var N,A=0,U=_.sortableMouseAligned,X=R.parentNode!==m,Y="vertical"===I?"top":"left";if(p!==_&&(u=null,N=i.boundingRect(_)[Y],d=!1),function(e,t,n){var a=i.boundingRect(e),r=i.boundingRect(t),o="vertical"===n?a.left:a.top,l="vertical"===n?a.right:a.bottom,s="vertical"===n?a.width:a.height,d="vertical"===n?r.left:r.top,c="vertical"===n?r.right:r.bottom,h="vertical"===n?r.width:r.height;return o===d||l===c||o+s/2===d+h/2}(R,_,I)&&U||X||E.invertSwap||"insert"===u||"swap"===u?("swap"!==u&&(c=E.invertSwap||X),A=function(e,t,n,a,r,o,l){var s=i.boundingRect(t),c="vertical"===n?e.clientY:e.clientX,h="vertical"===n?s.height:s.width,g="vertical"===n?s.top:s.left,v="vertical"===n?s.bottom:s.right,u=i.boundingRect(R),p=!1;if(!o)if(l&&b<h*a){if(!d&&(1===f?c>g+h*r/2:c<v-h*r/2)&&(d=!0),d)p=!0;else if("vertical"===n?u.top:u.left,"vertical"===n?u.bottom:u.right,1===f?c<g+b:c>v-b)return-1*f}else if(c>g+h*(1-a)/2&&c<v-h*(1-a)/2)return q(t);return(p=p||o)&&(c<g+h*r/2||c>v-h*r/2)?c>g+h/2?1:-1:0}(e,_,I,E.swapThreshold,null==E.invertedSwapThreshold?E.swapThreshold:E.invertedSwapThreshold,c,p===_),u="swap"):(A=q(_),u="insert"),0===A)return L(!1);p=_,f=A,r=i.boundingRect(_);var G=_.nextElementSibling,H=!1;H=1===A;var O=this._onMove(y,m,R,a,_,r,e,H);if(!1!==O)return 1!==O&&-1!==O||(H=1===O),h=!0,setTimeout(g,30),k?w._hideClone():w._showClone(this),H&&!G?m.appendChild(R):_.parentNode.insertBefore(R,H?G:_),l.parentEl=R.parentNode,void 0===N||c||(b=Math.abs(N-i.boundingRect(_)[Y])),j(),L(!0)}if(m.contains(R))return L(!1)}return!1}function L(t){return t&&(k?w._hideClone():w._showClone(D),w&&(n.toggleClass(R,S?S.options.ghostClass:w.options.ghostClass,!1),n.toggleClass(R,E.ghostClass,!0)),S!==D&&D!==l.active?S=l.putSortable=D:D===l.active&&(S=l.putSortable=null),a&&D._animate(a,R),_&&r&&D._animate(r,_)),(_===R&&!R.animated||_===m&&!_.animated)&&(p=null),E.dragoverBubble||e.rootEl||_===document||(l.over(e),!t&&l.nearestEmptyInsertDetectEvent(e)),!E.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),!0}function j(){D._dispatchEvent(D,y,"change",_,m,y,T,v(R),P,v(R,E.draggable),e)}function q(e){return v(R)<v(e)?1:-1}}_onDrop(e){this.el;var t,i,o=this.options,h=this.sortable,g=l.active.elm(),u=l.dragEl,p=l.putSortable,f=l.parentEl,b=l.oldIndex,m=l.oldDraggableIndex,_=l.nextEl;c=!1,d=!1,h.nativeDraggable&&a.off(document,"drop",this),this._offUpEvents(),e&&(s&&(e.cancelable&&e.preventDefault(),!o.dropBubble&&e.stopPropagation()),(g===f||p&&"clone"!==p.lastPutMode)&&r.remove(l.cloneEl),u&&(l._disableDraggable(u),u.style["will-change"]="",n.toggleClass(u,p?p.options.ghostClass:this.options.ghostClass,!1),n.toggleClass(u,this.options.chosenClass,!1),h._dispatchEvent(this,g,"unchoose",u,f,g,b,null,m,null,e),g!==f?(t=v(u),i=v(u,o.draggable),t>=0&&(h._dispatchEvent(null,f,"add",u,f,g,b,t,m,i,e),h._dispatchEvent(this,g,"remove",u,f,g,b,t,m,i,e),h._dispatchEvent(null,f,"sort",u,f,g,b,t,m,i,e),h._dispatchEvent(this,g,"sort",u,f,g,b,t,m,i,e)),p&&p.save()):u.nextSibling!==_&&(t=v(u),i=v(u,o.draggable),t>=0&&(h._dispatchEvent(this,g,"update",u,f,g,b,t,m,i,e),h._dispatchEvent(this,g,"sort",u,f,g,b,t,m,i,e))),l.active&&(null!=t&&-1!==t||(t=b,i=m),h._dispatchEvent(this,g,"end",u,f,g,b,t,m,i,e),h.save()))),this._nulling()}_offUpEvents(){var e=this.el.ownerDocument;a.off(e,"mouseup",this._onDrop),a.off(document,"selectstart",this)}_nulling(){s=null}handleEvent(e){switch(e.type){case"drop":this._onDrop(e);break;case"dragenter":case"dragover":l.dragEl&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}}}});
//# sourceMappingURL=sourcemaps/droppable.js.map
