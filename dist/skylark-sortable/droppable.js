/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx","skylark-domx-finder","skylark-domx-styler","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-domx-plugins-dnd/droppable","./dnd"],function(e,P,S,p,u,M,r,B){var I,N,A,O=!1;function U(e,t){for(var n=P.scrollableParent(e,!0),r=M.boundingRect(e)[t];n;){var o=M.boundingRect(n)[t],o="top"===t||"left"===t?o<=r:r<=o;if(!o)return n;if(n===u.scrollingElement())break;n=P.scrollableParent(n,!1)}return!1}function X(){O=!1}function Y(e){return P.lastChild(e,{ignoreHidden:!0,excluding:[]})}function G(e,t,n){var n=M.boundingRect(P.lastChild(n,{ignoreHidden:!0,excluding:[]})),r="vertical"===t?e.clientY:e.clientX,e="vertical"===t?e.clientX:e.clientY,o="vertical"===t?n.bottom:n.right,a="vertical"===t?n.left:n.top,n="vertical"===t?n.right:n.bottom;return"vertical"===t?n+10<e||e<=n&&o<r&&a<=e:o<r&&a<e||r<=o&&n+10<e}function H(e,t,n){var e=M.boundingRect(e),t=M.boundingRect(t),r="vertical"===n?e.left:e.top,o="vertical"===n?e.right:e.bottom,e="vertical"===n?e.width:e.height,a="vertical"===n?t.left:t.top,i="vertical"===n?t.right:t.bottom,n="vertical"===n?t.width:t.height;return r===a||o===i||r+e/2===a+n/2}function L(e,t){return P.index(e,function(e){return!("TEMPLATE"===e.nodeName.toUpperCase()||e===B.cloneEl||t&&!P.matches(e,t))})}function o(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}return class{constructor(e,t){this.sortable=e;var e=this.el=this._elm=e.elm(),n=(this.options=t,this);this._dndDroppable=new r(e,{started:function(e){e.acceptable=!0,e.activeClass="active",e.hoverClass="over"},overing:function(e){B.dragEl&&(n._onDragOver(e.originalEvent),o(e.originalEvent))},dropped:function(e){n._onDrop(e.originalEvent)}}),p.on(e,"drop",this),p.on(e,"selectstart",this)}_onMove(e,t,n,r,o,a,i,l){var s,d=e[B.expando],c=d.options.onMove,n=p.create("move",{to:t,from:e,dragged:n,draggedRect:r,related:o||t,relatedRect:a||M.boundingRect(t),willInsertAfter:l,originalEvent:i});return e.dispatchEvent(n),s=c?c.call(d,n,i):s}_onDragOver(t){var e,p,n=this._elm,r=t.target,o=this.options,a=o.group,i=B.active,l=B.activeGroup===a,s=o.sort,d=this.sortable,u=B.dragEl,c=B.active.elm(),h=B.putSortable,v=B.nextEl,g=B.oldIndex,f=B.oldDraggableIndex;if(!O){if(void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),I=!0,r=P.closest(r,o.draggable,n,!0),u.contains(t.target)||r.animated)return R(!1);if(i&&!o.disabled&&(l?s||(_=!c.contains(u)):h===this||(this.lastPutMode=B.activeGroup.checkPull(this,i,u,t))&&a.checkPut(this,i,u,t))){var s=d._getDirection(t,r),b=M.boundingRect(u);if(_)return this._hideClone(),B.parentEl=c,v?c.insertBefore(u,v):c.appendChild(u),R(!0);a=Y(n);if(!a||G(t,s,n)&&!a.animated){if((r=a&&n===t.target?a:r)&&(x=M.boundingRect(r)),l?i._hideClone():i._showClone(this),!1!==this._onMove(c,n,u,b,r,x,t,!!r))return n.appendChild(u),B.parentEl=n,y(),R(!0)}else if(r&&r!==u&&r.parentNode===n){var m,_=0,v=r.sortableMouseAligned,a=u.parentNode!==n,E="vertical"===s?"top":"left",C=U(r,"top")||U(u,"top"),D=C?C.scrollTop:void 0;if(w!==r&&(e=null,m=M.boundingRect(r)[E],N=!1),e=H(u,r,s)&&v||a||C||o.invertSwap||"insert"===e||"swap"===e?("swap"!==e&&(A=o.invertSwap||a),_=function(e,t,n,r,o,a,i){var l=M.boundingRect(t),e="vertical"===n?e.clientY:e.clientX,s="vertical"===n?l.height:l.width,d="vertical"===n?l.top:l.left,l="vertical"===n?l.bottom:l.right,c=M.boundingRect(u),h=!1;if(!a)if(i&&p<s*r)if(N=!N&&(1===k?d+s*o/2<e:e<l-s*o/2)?!0:N)h=!0;else{"vertical"===n?c.top:c.left,"vertical"===n?c.bottom:c.right;if(1===k?e<d+p:l-p<e)return-1*k}else if(d+s*(1-r)/2<e&&e<l-s*(1-r)/2)return T(t);return(h=h||a)&&(e<d+s*o/2||l-s*o/2<e)?d+s/2<e?1:-1:0}(t,r,s,o.swapThreshold,null==o.invertedSwapThreshold?o.swapThreshold:o.invertedSwapThreshold,A,w===r),"swap"):(_=T(r),"insert"),0===_)return R(!1);var w=r,k=_,x=M.boundingRect(r),v=r.nextElementSibling,a=!1,a=1===_,s=this._onMove(c,n,u,b,r,x,t,a);if(!1!==s)return 1!==s&&-1!==s||(a=1===s),O=!0,setTimeout(X,30),l?i._hideClone():i._showClone(this),a&&!v?n.appendChild(u):r.parentNode.insertBefore(u,a?v:r),C&&M.scrollBy(C,0,D-C.scrollTop),B.parentEl=u.parentNode,void 0===m||A||(p=Math.abs(m-M.boundingRect(r)[E])),y(),R(!0)}if(n.contains(u))return R(!1)}return!1}function R(e){return e&&(l?i._hideClone():i._showClone(d),i&&(S.toggleClass(u,(h||i).options.ghostClass,!1),S.toggleClass(u,o.ghostClass,!0)),h!==d&&d!==B.active?h=B.putSortable=d:d===B.active&&(h=B.putSortable=null),b&&d._animate(b,u),r)&&x&&d._animate(x,r),(r===u&&!u.animated||r===n&&!r.animated)&&(w=null),o.dragoverBubble||t.rootEl||r===document||(B.over(t),e)||B.nearestEmptyInsertDetectEvent(t),!o.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),!0}function y(){d._dispatchEvent(d,c,"change",r,n,c,g,L(u),f,L(u,o.draggable),t)}function T(e){return L(u)<L(e)?1:-1}}_onDrop(e){this.el;var t,n,r=this.options,o=this.sortable,a=B.active.elm(),i=B.dragEl,l=B.putSortable,s=B.parentEl,d=B.oldIndex,c=B.oldDraggableIndex,h=B.nextEl;N=A=!1,o.nativeDraggable&&p.off(document,"drop",this),this._offUpEvents(),e&&(I&&(e.cancelable&&e.preventDefault(),r.dropBubble||e.stopPropagation()),(a===s||l&&"clone"!==l.lastPutMode)&&u.remove(B.cloneEl),i)&&(B._disableDraggable(i),i.style["will-change"]="",S.toggleClass(i,(l||this).options.ghostClass,!1),S.toggleClass(i,this.options.chosenClass,!1),o._dispatchEvent(this,a,"unchoose",i,s,a,d,null,c,null,e),a!==s?(t=L(i),n=L(i,r.draggable),0<=t&&(o._dispatchEvent(null,s,"add",i,s,a,d,t,c,n,e),o._dispatchEvent(this,a,"remove",i,s,a,d,t,c,n,e),o._dispatchEvent(null,s,"sort",i,s,a,d,t,c,n,e),o._dispatchEvent(this,a,"sort",i,s,a,d,t,c,n,e)),l&&l.save()):i.nextSibling!==h&&(t=L(i),n=L(i,r.draggable),0<=t)&&(o._dispatchEvent(this,a,"update",i,s,a,d,t,c,n,e),o._dispatchEvent(this,a,"sort",i,s,a,d,t,c,n,e)),B.active)&&(null!=t&&-1!==t||(t=d,n=c),o._dispatchEvent(this,a,"end",i,s,a,d,t,c,n,e),o.save()),this._nulling()}_offUpEvents(){var e=this.el.ownerDocument;p.off(e,"mouseup",this._onDrop),p.off(document,"selectstart",this)}_nulling(){I=null}handleEvent(e){switch(e.type){case"drop":this._onDrop(e);break;case"dragenter":case"dragover":B.dragEl&&(this._onDragOver(e),o(e));break;case"selectstart":e.preventDefault()}}destroy(){this.sortable;his._dndDroppable.destroy()}}});
//# sourceMappingURL=sourcemaps/droppable.js.map
