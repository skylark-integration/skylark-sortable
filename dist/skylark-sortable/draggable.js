/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx","skylark-domx-finder","skylark-domx-styler","skylark-domx-eventer","skylark-domx-noder","skylark-devices-points/touch","./dnd"],function(t,e,a,n,l,s,r){var o,i=[];function d(t,a){return e.index(t,function(t){return!("TEMPLATE"===t.nodeName.toUpperCase()||t===r.cloneEl||a&&!e.matches(t,a))})}return class{constructor(t,e){this.sortable=t;var a=this._elm=t.elm();this.options=e,s.mousy(a),n.on(a,"mousedown",this._onMouseDown.bind(this))}elm(){return this._elm}_onMouseDown(t){var n,l,s=this.sortable,g=this._elm,c=this.options,h=c.preventOnFilter,f=t.type,p=t.target,u=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||p,m=c.filter;if(function(t){i.length=0;for(var e=t.getElementsByTagName("input"),a=e.length;a--;){var n=e[a];n.checked&&i.push(n)}}(g),!(/mousedown/.test(f)&&0!==t.button||c.disabled||u.isContentEditable||(p=e.closest(p,c.draggable,g,!1),o===p))){if(r.log("_onTapStart",p.tagName+","+p.className),n=d(p),l=d(p,c.draggable),"function"==typeof m){if(m.call(this,t,p,this))return s._dispatchEvent(s,u,"filter",p,g,g,n,void 0,l),void(h&&t.cancelable&&t.preventDefault())}else if(m&&(m=m.split(",").some(function(t){if(t=e.closest(u,t.trim(),g,!1))return s._dispatchEvent(s,t,"filter",p,g,g,n,void 0,l),!0})))return void(h&&t.cancelable&&t.preventDefault());if(!c.handle||e.closest(u,c.handle,g,!1)){g.ownerDocument;var v,_=r.dragEl,E=(r.parentEl,r.nextEl,r.oldIndex),b=r.oldDraggableIndex;r.tapEvt,r.log("_prepareDragStart","start"),p&&!_&&p.parentNode===g&&(v=g,_=r.dragEl=p,r.parentEl=_.parentNode,r.nextEl=_.nextSibling,o=p,r.activeGroup=this.options.group,E=r.oldIndex=n,b=r.oldDraggableIndex=l,r.tapEvt={target:_,clientX:t.clientX,clientY:t.clientY},this._lastX=t.clientX,this._lastY=t.clientY,_.style["will-change"]="all",_.style.transition="",_.style.transform="",c.ignore.split(",").forEach(function(t){!function(t,e,a){if(t){var n=t.getElementsByTagName(e),l=0,s=n.length;if(a)for(;l<s;l++)a(n[l],l)}}(_,t.trim(),r._disableDraggable)}),r.prepare(this,r.dragEl),s._dispatchEvent(s,v,"choose",_,v,v,E,void 0,b),a.toggleClass(_,c.chosenClass,!0))}}}_onDragStart(e,n){r.log("_onDragStart","start");var s=this,o=r.dragEl,i=this._elm,d=e.dataTransfer,g=s.options,c=r.cloneEl=l.clone(o,!0);c.draggable=!1,c.style["will-change"]="",a.toggleClass(c,s.options.chosenClass,!1),s._cloneId=t.defer(function(){s.options.removeCloneOnHide||i.insertBefore(c,o),s.sortable._dispatchEvent(s,i,"clone",o)}),n||a.toggleClass(o,g.dragClass,!0),n||(d&&(d.effectAllowed="move",g.setData&&g.setData.call(s,d,o)),a.css(o,"transform","translateZ(0)")),r.awaitingDragStarted=!0,s._dragStartId=t.defer(function(t,e){r.awaitingDragStarted=!1;var n=r.dragEl,l=this._elm,s=r.oldIndex,o=r.oldDraggableIndex;if(l&&n){r.start(this);var i=this.options;!t&&a.toggleClass(n,i.dragClass,!1),a.toggleClass(n,i.ghostClass,!0),a.css(n,"transform",""),this.sortable._dispatchEvent(this,l,"start",n,l,l,s,void 0,o,void 0,e)}else this._nulling()}.bind(s,n,e))}_onDragEnd(t){this._elm,this.options,r.dragEl,r.putSortable,r.awaitingDragStarted=!1,!1,clearTimeout(this._dragStartTimer),this._cloneId&&(this._cloneId.cancel(),this._cloneId=null),this._dragStartId&&(this._dragStartId.cancel(),this._dragStartId=null),this.nativeDraggable&&(n.off(r.dragEl,"dragstart",this._onDragStart),n.off(r.dragEl,"dragend",this._onDragEnd)),o=null,i.forEach(function(t){t.checked=!0}),i.length=0,r.end()}}});
//# sourceMappingURL=sourcemaps/draggable.js.map
