/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx","skylark-domx-finder","skylark-domx-styler","skylark-domx-eventer","skylark-domx-noder","skylark-devices-points/touch","./dnd"],function(t,e,a,s,l,n,o){var r,i=[];function d(t,a){return e.index(t,function(t){return!("TEMPLATE"===t.nodeName.toUpperCase()||t===o.cloneEl||a&&!e.matches(t,a))})}return class{constructor(t,e){this.sortable=t;var a=this._elm=t.elm();this.options=e,n.mousy(a),s.on(a,"mousedown",this._onMouseDown,this)}elm(){return this._elm}_onMouseDown(t){var s,l,n=this.sortable,g=this._elm,c=this.options,h=c.preventOnFilter,f=t.type,p=t.target,u=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||p,m=c.filter;if(function(t){i.length=0;for(var e=t.getElementsByTagName("input"),a=e.length;a--;){var s=e[a];s.checked&&i.push(s)}}(g),!(/mousedown/.test(f)&&0!==t.button||c.disabled||u.isContentEditable||(p=e.closest(p,c.draggable,g,!1),r===p))){if(o.log("_onTapStart",p.tagName+","+p.className),s=d(p),l=d(p,c.draggable),"function"==typeof m){if(m.call(this,t,p,this))return n._dispatchEvent(n,u,"filter",p,g,g,s,void 0,l),void(h&&t.cancelable&&t.preventDefault())}else if(m&&(m=m.split(",").some(function(t){if(t=e.closest(u,t.trim(),g,!1))return n._dispatchEvent(n,t,"filter",p,g,g,s,void 0,l),!0})))return void(h&&t.cancelable&&t.preventDefault());if(!c.handle||e.closest(u,c.handle,g,!1)){g.ownerDocument;var v,_=o.dragEl,E=(o.parentEl,o.nextEl,o.oldIndex),b=o.oldDraggableIndex;o.tapEvt,o.log("_prepareDragStart","start"),p&&!_&&p.parentNode===g&&(v=g,_=o.dragEl=p,o.parentEl=_.parentNode,o.nextEl=_.nextSibling,r=p,o.activeGroup=this.options.group,E=o.oldIndex=s,b=o.oldDraggableIndex=l,o.tapEvt={target:_,clientX:t.clientX,clientY:t.clientY},this._lastX=t.clientX,this._lastY=t.clientY,_.style["will-change"]="all",_.style.transition="",_.style.transform="",c.ignore.split(",").forEach(function(t){!function(t,e,a){if(t){var s=t.getElementsByTagName(e),l=0,n=s.length;if(a)for(;l<n;l++)a(s[l],l)}}(_,t.trim(),o._disableDraggable)}),o.prepare(this,o.dragEl),n._dispatchEvent(n,v,"choose",_,v,v,E,void 0,b),a.toggleClass(_,c.chosenClass,!0))}}}_onDragStart(e,s){o.log("_onDragStart","start");var n=this,r=o.dragEl,i=this._elm,d=e.dataTransfer,g=n.options,c=o.cloneEl=l.clone(r,!0);c.draggable=!1,c.style["will-change"]="",a.toggleClass(c,n.options.chosenClass,!1),n._cloneId=t.defer(function(){n.options.removeCloneOnHide||i.insertBefore(c,r),n.sortable._dispatchEvent(n,i,"clone",r)}),s||a.toggleClass(r,g.dragClass,!0),s||(d&&(d.effectAllowed="move",g.setData&&g.setData.call(n,d,r)),a.css(r,"transform","translateZ(0)")),o.awaitingDragStarted=!0,n._dragStartId=t.defer(function(t,e){o.awaitingDragStarted=!1;var s=o.dragEl,l=this._elm,n=o.oldIndex,r=o.oldDraggableIndex;if(l&&s){o.start(this);var i=this.options;!t&&a.toggleClass(s,i.dragClass,!1),a.toggleClass(s,i.ghostClass,!0),a.css(s,"transform",""),this.sortable._dispatchEvent(this,l,"start",s,l,l,n,void 0,r,void 0,e)}else this._nulling()}.bind(n,s,e))}_onDragEnd(t){this._elm,this.options,o.dragEl,this.sortable,o.putSortable,o.awaitingDragStarted=!1,!1,clearTimeout(this._dragStartTimer),this._cloneId&&(this._cloneId.cancel(),this._cloneId=null),this._dragStartId&&(this._dragStartId.cancel(),this._dragStartId=null),r=null,i.forEach(function(t){t.checked=!0}),i.length=0,o.end()}destroy(){s.off(el,"mousedown",this._onMouseDown)}}});
//# sourceMappingURL=sourcemaps/draggable.js.map
