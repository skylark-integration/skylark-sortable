/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx","skylark-domx-finder","skylark-domx-styler","skylark-domx-eventer","skylark-domx-noder","skylark-domx-plugins-dnd/draggable","./dnd"],function(t,e,a,r,n,l,i){var o,s=[];function d(t,a){return e.index(t,function(t){return!("TEMPLATE"===t.nodeName.toUpperCase()||t===i.cloneEl||a&&!e.matches(t,a))})}return class{constructor(t,e){this.sortable=t;var a=this._elm=t.elm();this.options=e;var r=this;this._dndDraggable=new l(a,{forceFallback:this.options.forceFallback,source:this.options.draggable,handle:this.options.handle,preparing:function(t){r._onPrepare(t)},started:function(t){r._onDragStart(t.originalEvent)},ended:function(t){r._onDragEnd(t.originalEvent)}})}elm(){return this._elm}_onPrepare(t){var r,n,l=this.sortable,g=this._elm,c=this.options,h=c.preventOnFilter,u=t.dragSource,f=c.filter;if(function(t){s.length=0;for(var e=t.getElementsByTagName("input"),a=e.length;a--;){var r=e[a];r.checked&&s.push(r)}}(g),o!==u){if(i.log("_onTapStart",u.tagName+","+u.className),r=d(u),n=d(u,c.draggable),"function"==typeof f){if(f.call(this,t,u,this))return l._dispatchEvent(l,originalTarget,"filter",u,g,g,r,void 0,n),h&&(t.preventDefault=!0),void(t.dragSource=null)}else if(f&&(f=f.split(",").some(function(a){if(a=e.closest(originalTarget,a.trim(),g,!1))return l._dispatchEvent(l,a,"filter",u,g,g,r,void 0,n),void(t.dragSource=null)})))return h&&(t.preventDefault=!0),void(t.dragSource=null);g.ownerDocument;var p,v=i.dragEl,_=(i.parentEl,i.nextEl,i.oldIndex),E=i.oldDraggableIndex;i.tapEvt,i.log("_prepareDragStart","start"),u&&!v&&u.parentNode===g&&(p=g,v=i.dragEl=u,i.parentEl=v.parentNode,i.nextEl=v.nextSibling,o=u,i.activeGroup=this.options.group,_=i.oldIndex=r,E=i.oldDraggableIndex=n,i.tapEvt={target:v,clientX:t.originalEvent.clientX,clientY:t.originalEvent.clientY},this._lastX=t.originalEvent.clientX,this._lastY=t.originalEvent.clientY,v.style["will-change"]="all",v.style.transition="",v.style.transform="",c.ignore.split(",").forEach(function(t){!function(t,e,a){if(t){var r=t.getElementsByTagName(e),n=0,l=r.length;if(a)for(;n<l;n++)a(r[n],n)}}(v,t.trim(),i._disableDraggable)}),i.prepare(this,i.dragEl),l._dispatchEvent(l,p,"choose",v,p,p,_,void 0,E),a.toggleClass(v,c.chosenClass,!0))}else t.dragSource=null}_onDragStart(e,r){i.log("_onDragStart","start");var l=this,o=i.dragEl,s=this._elm,d=e.dataTransfer,g=l.options,c=i.cloneEl=n.clone(o,!0);c.draggable=!1,c.style["will-change"]="",a.toggleClass(c,l.options.chosenClass,!1),l._cloneId=t.defer(function(){l.options.removeCloneOnHide||s.insertBefore(c,o),l.sortable._dispatchEvent(l,s,"clone",o)}),r||a.toggleClass(o,g.dragClass,!0),r||(d&&(d.effectAllowed="move",g.setData&&g.setData.call(l,d,o)),a.css(o,"transform","translateZ(0)")),i.awaitingDragStarted=!0,l._dragStartId=t.defer(function(t,e){i.awaitingDragStarted=!1;var r=i.dragEl,n=this._elm,l=i.oldIndex,o=i.oldDraggableIndex;if(n&&r){i.start(this);var s=this.options;!t&&a.toggleClass(r,s.dragClass,!1),a.toggleClass(r,s.ghostClass,!0),a.css(r,"transform",""),this.sortable._dispatchEvent(this,n,"start",r,n,n,l,void 0,o,void 0,e)}else this._nulling()}.bind(l,r,e))}_onDragEnd(t){this._elm,this.options,i.dragEl,this.sortable,i.putSortable,i.awaitingDragStarted=!1,!1,clearTimeout(this._dragStartTimer),this._cloneId&&(this._cloneId.cancel(),this._cloneId=null),this._dragStartId&&(this._dragStartId.cancel(),this._dragStartId=null),o=null,s.forEach(function(t){t.checked=!0}),s.length=0,i.end()}}});
//# sourceMappingURL=sourcemaps/draggable.js.map
