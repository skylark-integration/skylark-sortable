/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx","skylark-domx-finder","skylark-domx-styler","skylark-domx-eventer","skylark-domx-noder","skylark-domx-plugins-dnd/draggable","./dnd"],function(s,c,h,t,d,n,p){var u,r=[];function f(t,e,a){if(t){var n=t.getElementsByTagName(e),r=0,l=n.length;if(a)for(;r<l;r++)a(n[r],r)}}function v(t,e){return c.index(t,function(t){return!("TEMPLATE"===t.nodeName.toUpperCase()||t===p.cloneEl||e&&!c.matches(t,e))})}function _(t){r.length=0;for(var e=t.getElementsByTagName("input"),a=e.length;a--;){var n=e[a];n.checked&&r.push(n)}}return class{constructor(t,e){this.sortable=t;var t=this._elm=t.elm(),a=(this.options=e,this);this._dndDraggable=new n(t,{forceFallback:this.options.forceFallback,source:this.options.draggable,handle:this.options.handle,preparing:function(t){a._onPrepare(t)},started:function(t){a._onDragStart(t.originalEvent)},ended:function(t){a._onDragEnd(t.originalEvent)}})}elm(){return this._elm}_onPrepare(e){var a,n,r=this.sortable,l=this._elm,t=this.options,i=t.preventOnFilter,o=e.dragSource,s=t.filter;if(_(l),u===o)e.dragSource=null;else{if(p.log("_onTapStart",o.tagName+","+o.className),a=v(o),n=v(o,t.draggable),"function"==typeof s){if(s.call(this,e,o,this))return r._dispatchEvent(r,originalTarget,"filter",o,l,l,a,void 0,n),i&&(e.preventDefault=!0),void(e.dragSource=null)}else if(s=s&&s.split(",").some(function(t){(t=c.closest(originalTarget,t.trim(),l,!1))&&(r._dispatchEvent(r,t,"filter",o,l,l,a,void 0,n),e.dragSource=null)}))return i&&(e.preventDefault=!0),void(e.dragSource=null);l.ownerDocument;var d,g=p.dragEl;p.parentEl,p.nextEl,p.oldIndex,p.oldDraggableIndex,p.tapEvt;p.log("_prepareDragStart","start"),o&&!g&&o.parentNode===l&&(s=l,g=p.dragEl=o,p.parentEl=g.parentNode,p.nextEl=g.nextSibling,u=o,p.activeGroup=this.options.group,i=p.oldIndex=a,d=p.oldDraggableIndex=n,p.tapEvt={target:g,clientX:e.originalEvent.clientX,clientY:e.originalEvent.clientY},this._lastX=e.originalEvent.clientX,this._lastY=e.originalEvent.clientY,g.style["will-change"]="all",g.style.transition="",g.style.transform="",t.ignore.split(",").forEach(function(t){f(g,t.trim(),p._disableDraggable)}),p.prepare(this,p.dragEl),r._dispatchEvent(r,s,"choose",g,s,s,i,void 0,d),h.toggleClass(g,t.chosenClass,!0))}}_onDragStart(t,e){p.log("_onDragStart","start");var a=this,n=p.dragEl,r=this._elm,l=t.dataTransfer,i=a.options,o=p.cloneEl=d.clone(n,!0);o.draggable=!1,o.style["will-change"]="",h.toggleClass(o,a.options.chosenClass,!1),a._cloneId=s.defer(function(){a.options.removeCloneOnHide||r.insertBefore(o,n),a.sortable._dispatchEvent(a,r,"clone",n)}),e||h.toggleClass(n,i.dragClass,!0),e||(l&&(l.effectAllowed="move",i.setData)&&i.setData.call(a,l,n),h.css(n,"transform","translateZ(0)")),p.awaitingDragStarted=!0,a._dragStartId=s.defer(function(t,e){p.awaitingDragStarted=!1;var a,n=p.dragEl,r=this._elm,l=p.oldIndex,i=p.oldDraggableIndex;r&&n?(p.start(this),a=this.options,t||h.toggleClass(n,a.dragClass,!1),h.toggleClass(n,a.ghostClass,!0),h.css(n,"transform",""),this.sortable._dispatchEvent(this,r,"start",n,r,r,l,void 0,i,void 0,e)):this._nulling()}.bind(a,e,t))}_onDragEnd(t){this._elm,this.options,p.dragEl,this.sortable,p.putSortable;p.awaitingDragStarted=!1,clearTimeout(this._dragStartTimer),this._cloneId&&(this._cloneId.cancel(),this._cloneId=null),this._dragStartId&&(this._dragStartId.cancel(),this._dragStartId=null),u=null,r.forEach(function(t){t.checked=!0}),r.length=0,p.end()}}});
//# sourceMappingURL=sourcemaps/draggable.js.map
