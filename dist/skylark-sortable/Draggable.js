/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-langx-hoster/isBrowser","skylark-langx-hoster/isMobile","skylark-domx-query","skylark-domx-browser","skylark-domx-noder","skylark-domx-finder","skylark-domx-geom","skylark-domx-styler","skylark-domx-eventer","skylark-domx-transforms","skylark-domx-scrolls/scrollingElement","skylark-domx-layouts/oriented","skylark-domx-plugins","skylark-devices-points/touch","./autoscroll","./containers","./dnd","./ghoster"],function(t,e,a,n,l,r,o,s,i,d,g,c,h,p,u,f,_,v,m,E){"use strict";var b,k=[];return u.Plugin.inherit({klassName:"Draggable",pluginName:"intg.sortable.draggable",options:{draggingClass:"dragging",chosenClass:null},_construct:function(t,e){this.overrided(t,e);var a=this._elm;for(var n in this.nativeDraggable=e.nativeDraggable,this.sortable=e.sortable,this.nativeDraggable&&(this.options.touchStartThreshold=1),this)"_"===n.charAt(0)&&"function"==typeof this[n]&&(this[n]=this[n].bind(this));f.mousy(a),g.on(a,"mousedown",this._onTapStart)},_onTapStart:function(t){var e,a,n=this,l=this._elm,r=this.options,o=r.preventOnFilter,i=t.type,d=t.touches&&t.touches[0],g=(d||t).target,c=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||g,h=r.filter;if(function(t){k.length=0;for(var e=t.getElementsByTagName("input"),a=e.length;a--;){var n=e[a];n.checked&&k.push(n)}}(l),!m.dragEl&&!(/mousedown|pointerdown/.test(i)&&0!==t.button||r.disabled||c.isContentEditable||(g=s.closest(g,r.draggable,l,!1),b===g))){if(m.log("_onTapStart",g.tagName+","+g.className),e=v._index(g),a=v._index(g,r.draggable),"function"==typeof h){if(h.call(this,t,g,this))return m._dispatchEvent(n,c,"filter",g,l,l,e,void 0,a),void(o&&t.cancelable&&t.preventDefault())}else if(h&&(h=h.split(",").some(function(t){if(t=s.closest(c,t.trim(),l,!1))return m._dispatchEvent(n,t,"filter",g,l,l,e,void 0,a),!0})))return void(o&&t.cancelable&&t.preventDefault());r.handle&&!s.closest(c,r.handle,l,!1)||this._prepareDragStart(t,d,g,e,a)}},_prepareDragStart:function(t,e,a,n,l){var r,o,s=this,i=s._elm,g=s.options,c=(i.ownerDocument,m.dragEl),h=(m.parentEl,m.nextEl,m.oldIndex),p=m.oldDraggableIndex;m.tapEvt;m.log("_prepareDragStart","start"),a&&!c&&a.parentNode===i&&(o=i,c=m.dragEl=a,m.parentEl=c.parentNode,m.nextEl=c.nextSibling,b=a,m.activeGroup=this.sortable.options.group,h=m.oldIndex=n,p=m.oldDraggableIndex=l,m.tapEvt={target:c,clientX:(e||t).clientX,clientY:(e||t).clientY},this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,c.style["will-change"]="all",c.style.transition="",c.style.transform="",r=function(){s.nativeDraggable&&(c.draggable=!0),s._triggerDragStart(t,e),m._dispatchEvent(s,o,"choose",c,o,o,h,void 0,p),d.toggleClass(c,g.chosenClass,!0)},g.ignore.split(",").forEach(function(t){!function(t,e,a){if(t){var n=t.getElementsByTagName(e),l=0,r=n.length;if(a)for(;l<r;l++)a(n[l],l);return n}}(c,t.trim(),m._disableDraggable)}),this.nativeDraggable&&(this.options.touchStartThreshold=4,c.draggable=!0),r())},_triggerDragStart:function(t,a){m.log("_triggerDragStart","start"),m.log("_triggerDragStart","nativeDraggable is "+this.nativeDraggable),m.prepare(this),this.nativeDraggable&&(g.on(m.dragEl,"dragend",this._onDragEnd),g.on(m.dragEl,"dragstart",this._onDragStart));try{document.selection?e.defer(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(t){}},_onDragStart:function(t,a){var n=this,l=m.dragEl,r=this._elm,s=t.dataTransfer,i=n.options,g=m.cloneEl=o.clone(l,!0);g.draggable=!1,g.style["will-change"]="",this._hideClone(),d.toggleClass(g,n.options.chosenClass,!1),n._cloneId=e.defer(function(){n.options.removeCloneOnHide||r.insertBefore(g,l),m._dispatchEvent(n,r,"clone",l)}),!a&&d.toggleClass(l,i.dragClass,!0),a?(m.ignoreNextClick=!0,n._loopId=setInterval(m._emulateDragOver.bind(m),50)):(s&&(s.effectAllowed="move",i.setData&&i.setData.call(n,s,l)),d.css(l,"transform","translateZ(0)")),m.awaitingDragStarted=!0,n._dragStartId=e.defer(n._dragStarted.bind(n,a,t))},_dragStarted:function(t,e){m.awaitingDragStarted=!1;var a=m.dragEl,n=this._elm,l=m.oldIndex,r=m.oldDraggableIndex;if(n&&a){m.start(this);var o=this.options;!t&&d.toggleClass(a,o.dragClass,!1),d.toggleClass(a,o.ghostClass,!0),d.css(a,"transform",""),m.active=this.sortable,t&&this._appendGhost(),m._dispatchEvent(this,n,"start",a,n,n,l,void 0,r,void 0,e)}else this._nulling()},_appendGhost:function(){var t=this.elm(),e=this.options.fallbackOnBody?document.body:t;return E._appendGhost(m.dragEl,e,this.options)},_nulling:function(){b=null,k.forEach(function(t){t.checked=!0}),k.length=0},_hideClone:function(){m.cloneEl.cloneHidden||(d.hide(m.cloneEl),m.cloneEl.cloneHidden=!0,m.cloneEl.parentNode&&this.options.removeCloneOnHide&&o.remove(m.cloneEl))},_showClone:function(t){var e=m.active.el,a=m.nextEl;"clone"===t.lastPutMode?m.cloneEl.cloneHidden&&(e.contains(m.dragEl)&&!this.options.group.revertClone?e.insertBefore(m.cloneEl,m.dragEl):a?e.insertBefore(m.cloneEl,a):e.appendChild(m.cloneEl),this.options.group.revertClone&&this._animate(m.dragEl,m.cloneEl),d.show(m.cloneEl),m.cloneEl.cloneHidden=!1):this._hideClone()},_onDragEnd:function(t){this._elm,this.options,m.dragEl,m.putSortable;m.awaitingDragStarted=!1,!1,clearInterval(this._loopId),_._nulling(),_._clearAutoScrolls(),_._cancelThrottle(),clearTimeout(this._dragStartTimer),this._cloneId&&(this._cloneId.stop(),this._cloneId=null),this._dragStartId&&(this._dragStartId.stop(),this._dragStartId=null),this.nativeDraggable&&(g.off(m.dragEl,"dragstart",this._onDragStart),g.off(m.dragEl,"dragend",this._onDragEnd)),m.end(),this._nulling()}})});
//# sourceMappingURL=sourcemaps/Draggable.js.map
