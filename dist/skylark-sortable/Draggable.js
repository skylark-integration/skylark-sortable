/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-langx-hoster/isBrowser","skylark-langx-hoster/isMobile","skylark-domx-query","skylark-domx-browser","skylark-domx-noder","skylark-domx-finder","skylark-domx-geom","skylark-domx-styler","skylark-domx-eventer","skylark-domx-transforms","skylark-domx-scrolls/scrollingElement","skylark-domx-layouts/oriented","skylark-domx-plugins","skylark-devices-points/touch","./autoscroll","./containers","./dnd","./ghoster"],function(e,t,a,l,r,n,o,s,i,d,g,h,c,u,_,p,f,m,v,D){"use strict";var E,b=[];return _.Plugin.inherit({klassName:"Draggable",pluginName:"intg.sortable.draggable",options:{draggingClass:"dragging"},_construct:function(e,t){this.overrided(e,t);var a=this._elm;for(var l in this.nativeDraggable=t.nativeDraggable,this.sortable=t.sortable,this.nativeDraggable&&(this.options.touchStartThreshold=1),this)"_"===l.charAt(0)&&"function"==typeof this[l]&&(this[l]=this[l].bind(this));p.mousy(a),g.on(a,"mousedown",this._onTapStart)},_onTapStart:function(e){var t,a,l=this,r=this._elm,n=this.options,o=n.preventOnFilter,i=e.type,d=e.touches&&e.touches[0],g=(d||e).target,h=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||g,c=n.filter;if(function(e){b.length=0;for(var t=e.getElementsByTagName("input"),a=t.length;a--;){var l=t[a];l.checked&&b.push(l)}}(r),!v.dragEl&&!(/mousedown|pointerdown/.test(i)&&0!==e.button||n.disabled||h.isContentEditable||(g=s.closest(g,n.draggable,r,!1),E===g))){if(v.log("_onTapStart",g.tagName+","+g.className),t=m._index(g),a=m._index(g,n.draggable),"function"==typeof c){if(c.call(this,e,g,this))return v._dispatchEvent(l,h,"filter",g,r,r,t,void 0,a),void(o&&e.cancelable&&e.preventDefault())}else if(c&&(c=c.split(",").some(function(e){if(e=s.closest(h,e.trim(),r,!1))return v._dispatchEvent(l,e,"filter",g,r,r,t,void 0,a),!0})))return void(o&&e.cancelable&&e.preventDefault());n.handle&&!s.closest(h,n.handle,r,!1)||this._prepareDragStart(e,d,g,t,a)}},_prepareDragStart:function(e,t,a,l,r){var n,o,s=this,i=s._elm,h=s.options,c=i.ownerDocument,u=v.dragEl,_=(v.parentEl,v.nextEl,v.oldIndex),p=v.oldDraggableIndex;v.log("_prepareDragStart","start"),a&&!u&&a.parentNode===i&&(o=i,u=v.dragEl=a,v.parentEl=u.parentNode,v.nextEl=u.nextSibling,E=a,v.activeGroup=this.sortable.options.group,_=v.oldIndex=l,p=v.oldDraggableIndex=r,{target:u,clientX:(t||e).clientX,clientY:(t||e).clientY},this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,u.style["will-change"]="all",u.style.transition="",u.style.transform="",n=function(){s._disableDelayedDragEvents(),s.nativeDraggable&&(u.draggable=!0),s._triggerDragStart(e,t),v._dispatchEvent(s,o,"choose",u,o,o,_,void 0,p),d.toggleClass(u,h.chosenClass,!0)},h.ignore.split(",").forEach(function(e){!function(e,t,a){if(e){var l=e.getElementsByTagName(t),r=0,n=l.length;if(a)for(;r<n;r++)a(l[r],r);return l}}(u,e.trim(),v._disableDraggable)}),this.nativeDraggable&&(this.options.touchStartThreshold=4,u.draggable=!0),!h.delay||h.delayOnTouchOnly&&!t||this.nativeDraggable&&(Edge||IE11OrLess)?n():(g.on(c,"mouseup",s._disableDelayedDrag),g.on(c,"mousemove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(n,h.delay)))},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){v.dragEl&&v._disableDraggable(v.dragEl),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this._elm.ownerDocument;g.off(e,"mouseup",this._disableDelayedDrag),g.off(e,"mousemove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,a){v.log("_triggerDragStart","start"),v.log("_triggerDragStart","nativeDraggable is "+this.nativeDraggable),v.prepare(this),this.nativeDraggable&&(g.on(v.dragEl,"dragend",this._onDragEnd),g.on(v.dragEl,"dragstart",this._onDragStart));try{document.selection?t.defer(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_onDragStart:function(e,a){var l=this,r=v.dragEl,n=this._elm,s=e.dataTransfer,i=l.options,g=v.cloneEl=o.clone(r,!0);g.draggable=!1,g.style["will-change"]="",this._hideClone(),d.toggleClass(g,l.options.chosenClass,!1),l._cloneId=t.defer(function(){l.options.removeCloneOnHide||n.insertBefore(g,r),v._dispatchEvent(l,n,"clone",r)}),!a&&d.toggleClass(r,i.dragClass,!0),a?(v.ignoreNextClick=!0,l._loopId=setInterval(v._emulateDragOver.bind(v),50)):(s&&(s.effectAllowed="move",i.setData&&i.setData.call(l,s,r)),d.css(r,"transform","translateZ(0)")),v.awaitingDragStarted=!0,l._dragStartId=t.defer(l._dragStarted.bind(l,a,e))},_dragStarted:function(e,t){v.awaitingDragStarted=!1;var a=v.dragEl,l=this._elm,r=v.oldIndex,n=v.oldDraggableIndex;if(l&&a){v.start(this);var o=this.options;!e&&d.toggleClass(a,o.dragClass,!1),d.toggleClass(a,o.ghostClass,!0),d.css(a,"transform",""),v.active=this.sortable,e&&this._appendGhost(),v._dispatchEvent(this,l,"start",a,l,l,r,void 0,n,void 0,t)}else this._nulling()},_nulling:function(){E=null,null,b.forEach(function(e){e.checked=!0}),b.length=0},_hideClone:function(){v.cloneEl.cloneHidden||(d.hide(v.cloneEl),v.cloneEl.cloneHidden=!0,v.cloneEl.parentNode&&this.options.removeCloneOnHide&&v.cloneEl.parentNode.removeChild(v.cloneEl))},_showClone:function(e){var t=v.active.el,a=v.nextEl;"clone"===e.lastPutMode?v.cloneEl.cloneHidden&&(t.contains(v.dragEl)&&!this.options.group.revertClone?t.insertBefore(v.cloneEl,v.dragEl):a?t.insertBefore(v.cloneEl,a):t.appendChild(v.cloneEl),this.options.group.revertClone&&this._animate(v.dragEl,v.cloneEl),d.show(v.cloneEl),v.cloneEl.cloneHidden=!1):this._hideClone()},_onDragEnd:function(e){this._elm,this.options,v.dragEl,v.putSortable;v.awaitingDragStarted=!1,!1,clearInterval(this._loopId),f._nulling(),f._clearAutoScrolls(),f._cancelThrottle(),clearTimeout(this._dragStartTimer),this._cloneId&&(this._cloneId.stop(),this._cloneId=null),this._dragStartId&&(this._dragStartId.stop(),this._dragStartId=null),this.nativeDraggable&&(g.off(v.dragEl,"dragstart",this._onDragStart),g.off(v.dragEl,"dragend",this._onDragEnd)),v.end(),this._nulling()}})});
//# sourceMappingURL=sourcemaps/Draggable.js.map
