{"version":3,"sources":["ghoster.js"],"names":["define","skylark","langx","isBrowser","isMobile","$","browser","noder","finder","geom","styler","eventer","transforms","scrollingElement","oriented","touch","_getRect","el","adjustForTransform","container","adjustForFixed","getBoundingClientRect","window","top","left","bottom","right","width","height","boundingRect","matrix","scaleX","a","scaleY","d","ghostEl","PositionGhostAbsolutely","apple","device","ghostRelativeParent","ghostRelativeParentInitialScroll","_ghostIsLast","evt","axis","elRect","lastChild","ignoreHidden","excluding","this","mouseOnAxis","clientY","clientX","mouseOnOppAxis","targetS2","targetS1Opp","targetS2Opp","_lastChild","_appendGhost","dragEl","options","rect","css","document","parentNode","ghostRelativeParentRect","body","documentElement","scrollTop","scrollLeft","autoscroll","_getRelativeScrollOffset","cloneNode","toggleClass","ghostClass","fallbackClass","dragClass","box-sizing","margin","opacity","position","zIndex","pointerEvents","appendChild","getRelativeScrollOffset","remove"],"mappings":"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","file":"../ghoster.js","sourcesContent":["define([\r\n\t\"skylark-langx/skylark\",\r\n\t\"skylark-langx/langx\",\r\n\t\"skylark-langx-hoster/isBrowser\",\r\n\t\"skylark-langx-hoster/isMobile\",\r\n\t\"skylark-domx-query\",\r\n\t\"skylark-domx-browser\",\r\n\t\"skylark-domx-noder\",\r\n\t\"skylark-domx-finder\",\r\n\t\"skylark-domx-geom\",\r\n\t\"skylark-domx-styler\",\r\n\t\"skylark-domx-eventer\",\r\n\t\"skylark-domx-transforms\",\r\n\t\"skylark-domx-scrolls/scrollingElement\",\r\n\t\"skylark-domx-layouts/oriented\",\r\n\t\"skylark-devices-points/touch\"\r\n],function(\r\n\tskylark,\r\n\tlangx,\r\n\tisBrowser,\r\n\tisMobile,\r\n\t$,\r\n\tbrowser,\r\n\tnoder,\r\n\tfinder,\r\n\tgeom,\r\n\tstyler,\r\n\teventer,\r\n\ttransforms,\r\n\tscrollingElement,\r\n\toriented,\r\n\ttouch\r\n){\r\n    'use strict';\r\n\r\n\t/**\r\n\t * Returns the \"bounding client rect\" of given element\r\n\t * @param  {HTMLElement} el                The element whose boundingClientRect is wanted\r\n\t * @param  {[HTMLElement]} container       the parent the element will be placed in\r\n\t * @param  {[Boolean]} adjustForTransform  Whether the rect should compensate for parent's transform\r\n\t * @return {Object}                        The boundingClientRect of el\r\n\t */\r\n\tfunction _getRect(el, adjustForTransform, container, adjustForFixed) {\r\n\t\tif (!el.getBoundingClientRect && el !== window) return;\r\n\t\tvar {\r\n\t\t\ttop,\r\n\t\t\tleft,\r\n\t\t\tbottom,\r\n\t\t\tright,\r\n\t\t\twidth,\r\n\t\t\theight\r\n\t\t} = geom.boundingRect(el);\r\n\t\t\r\n\t\tif (adjustForTransform && el !== window) {\r\n\t\t\t// Adjust for scale()\r\n\t\t\tvar matrix = transforms.matrix(container || el),\r\n\t\t\t\tscaleX = matrix && matrix.a,\r\n\t\t\t\tscaleY = matrix && matrix.d;\r\n\r\n\t\t\tif (matrix) {\r\n\t\t\t\ttop /= scaleY;\r\n\t\t\t\tleft /= scaleX;\r\n\r\n\t\t\t\twidth /= scaleX;\r\n\t\t\t\theight /= scaleY;\r\n\r\n\t\t\t\tbottom = top + height;\r\n\t\t\t\tright = left + width;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttop: top,\r\n\t\t\tleft: left,\r\n\t\t\tbottom: bottom,\r\n\t\t\tright: right,\r\n\t\t\twidth: width,\r\n\t\t\theight: height\r\n\t\t};\r\n\t}\r\n\r\n\r\n\tvar ghoster = {\r\n\t\tghostEl : null,\r\n\r\n\t\tPositionGhostAbsolutely : isMobile.apple.device, //IOS\r\n\t\t// For positioning ghost absolutely\r\n\t\tghostRelativeParent : null,\r\n\t\tghostRelativeParentInitialScroll : [], // (left, top)\r\n\r\n\t\t_ghostIsLast : function (evt, axis, el) {\r\n\t\t\tvar elRect = geom.boundingRect(finder.lastChild(el,{ignoreHidden : true,excluding : [this.ghostEl]})),\r\n\t\t\t\tmouseOnAxis = axis === 'vertical' ? evt.clientY : evt.clientX,\r\n\t\t\t\tmouseOnOppAxis = axis === 'vertical' ? evt.clientX : evt.clientY,\r\n\t\t\t\ttargetS2 = axis === 'vertical' ? elRect.bottom : elRect.right,\r\n\t\t\t\ttargetS1Opp = axis === 'vertical' ? elRect.left : elRect.top,\r\n\t\t\t\ttargetS2Opp = axis === 'vertical' ? elRect.right : elRect.bottom,\r\n\t\t\t\tspacer = 10;\r\n\r\n\t\t\treturn (\r\n\t\t\t\taxis === 'vertical' ?\r\n\t\t\t\t\t(mouseOnOppAxis > targetS2Opp + spacer || mouseOnOppAxis <= targetS2Opp && mouseOnAxis > targetS2 && mouseOnOppAxis >= targetS1Opp) :\r\n\t\t\t\t\t(mouseOnAxis > targetS2 && mouseOnOppAxis > targetS1Opp || mouseOnAxis <= targetS2 && mouseOnOppAxis > targetS2Opp + spacer)\r\n\t\t\t);\r\n\t\t},\r\n\r\n\r\n\t\t/**\r\n\t\t * Gets the last child in the el, ignoring ghostEl or invisible elements (clones)\r\n\t\t * @param  {HTMLElement} el       Parent element\r\n\t\t * @return {HTMLElement}          The last child, ignoring ghostEl\r\n\t\t */\r\n\t\t_lastChild : function (el) {\r\n\t\t\t/*\r\n\t\t\tvar last = el.lastElementChild;\r\n\r\n\t\t\twhile (last && (last === ghostEl || styler.css(last, 'display') === 'none')) {\r\n\t\t\t\tlast = last.previousElementSibling;\r\n\t\t\t}\r\n\r\n\t\t\treturn last || null;\r\n\t\t\t*/\r\n\t\t\treturn finder.lastChild(el,{\r\n\t\t\t\tignoreHidden : true,\r\n\t\t\t\texcluding : [this.ghostEl]\r\n\t\t\t})\r\n\t\t},\r\n\r\n\t\t_appendGhost: function (dragEl,container,options) {\r\n\t\t\t// Bug if using scale(): https://stackoverflow.com/questions/2637058\r\n\t\t\t// Not being adjusted for\r\n\t\t\tvar /// dragEl = dnd.dragEl,\r\n\t\t\t\tghostEl = this.ghostEl;\r\n\r\n\t\t\tif (!ghostEl) {\r\n\t\t\t\tvar ///container = this.options.fallbackOnBody ? document.body : rootEl,\r\n\t\t\t\t\trect = _getRect(dragEl, true, container, !this.PositionGhostAbsolutely),\r\n\t\t\t\t\tcss = styler.css(dragEl);\r\n\t\t\t\t\t///options = this.options;\r\n\r\n\t\t\t\t// Position absolutely\r\n\t\t\t\tif (this.PositionGhostAbsolutely) {\r\n\t\t\t\t\t// Get relatively positioned parent\r\n\t\t\t\t\tvar ghostRelativeParent = this.ghostRelativeParent = container;\r\n\r\n\t\t\t\t\twhile (\r\n\t\t\t\t\t\tstyler.css(ghostRelativeParent, 'position') === 'static' &&\r\n\t\t\t\t\t\tstyler.css(ghostRelativeParent, 'transform') === 'none' &&\r\n\t\t\t\t\t\tghostRelativeParent !== document\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tghostRelativeParent = ghostRelativeParent.parentNode;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (ghostRelativeParent !== document) {\r\n\t\t\t\t\t\tvar ghostRelativeParentRect = _getRect(ghostRelativeParent, true);\r\n\r\n\t\t\t\t\t\trect.top -= ghostRelativeParentRect.top;\r\n\t\t\t\t\t\trect.left -= ghostRelativeParentRect.left;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (ghostRelativeParent !== document.body && ghostRelativeParent !== document.documentElement) {\r\n\t\t\t\t\t\tif (ghostRelativeParent === document) {\r\n\t\t\t\t\t\t\tghostRelativeParent = this.ghostRelativeParent = scrollingElement();\r\n\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\trect.top += ghostRelativeParent.scrollTop;\r\n\t\t\t\t\t\trect.left += ghostRelativeParent.scrollLeft;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tghostRelativeParent = this.ghostRelativeParent = scrollingElement();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tghostRelativeParentInitialScroll = autoscroll._getRelativeScrollOffset(ghostRelativeParent);\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tghostEl =this.ghostEl = dragEl.cloneNode(true);\r\n\r\n\t\t\t\tstyler.toggleClass(ghostEl, options.ghostClass, false);\r\n\t\t\t\tstyler.toggleClass(ghostEl, options.fallbackClass, true);\r\n\t\t\t\tstyler.toggleClass(ghostEl, options.dragClass, true);\r\n\r\n\t\t\t\t/*\r\n\t\t\t\tstyler.css(ghostEl, 'box-sizing', 'border-box');\r\n\t\t\t\tstyler.css(ghostEl, 'margin', 0);\r\n\t\t\t\tstyler.css(ghostEl, 'top', rect.top);\r\n\t\t\t\tstyler.css(ghostEl, 'left', rect.left);\r\n\t\t\t\tstyler.css(ghostEl, 'width', rect.width);\r\n\t\t\t\tstyler.css(ghostEl, 'height', rect.height);\r\n\t\t\t\tstyler.css(ghostEl, 'opacity', '0.8');\r\n\t\t\t\tstyler.css(ghostEl, 'position', (this.PositionGhostAbsolutely ? 'absolute' : 'fixed'));\r\n\t\t\t\tstyler.css(ghostEl, 'zIndex', '100000');\r\n\t\t\t\tstyler.css(ghostEl, 'pointerEvents', 'none');\r\n\t\t\t\t*/\r\n\r\n\t\t\t\tstyler.css(ghostEl, {\r\n\t\t\t\t\t'box-sizing': 'border-box',\r\n\t\t\t\t\t'margin': 0,\r\n\t\t\t\t\t'top': rect.top,\r\n\t\t\t\t\t'left': rect.left,\r\n\t\t\t\t\t'width': rect.width,\r\n\t\t\t\t\t'height': rect.height,\r\n\t\t\t\t\t'opacity': '0.8',\r\n\t\t\t\t\t'position': (this.PositionGhostAbsolutely ? 'absolute' : 'fixed'),\r\n\t\t\t\t\t'zIndex': '100000',\r\n\t\t\t\t\t'pointerEvents': 'none'\t\r\n\t\t\t\t});\r\n\t\t\t\tcontainer.appendChild(ghostEl);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetRelativeScrollOffset : function(){\r\n\t\t\treturn this.PositionGhostAbsolutely && this.ghostRelativeParent && autoscroll._getRelativeScrollOffset(this.ghostRelativeParent);\r\n\t\t},\r\n\r\n\t\tremove : function() {\r\n\t\t\tif (this.ghostEl) {\r\n\t\t\t\tnoder.remove(this.ghostEl);\r\n\t\t\t} \r\n\t\t\tthis.ghostEl = null;\r\n\r\n\t\t}\r\n\r\n\r\n\t};\r\n\r\n\treturn ghoster;\r\n\t\r\n});"]}