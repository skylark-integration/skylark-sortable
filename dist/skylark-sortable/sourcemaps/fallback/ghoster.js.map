{"version":3,"sources":["fallback/ghoster.js"],"names":["define","skylark","langx","isBrowser","isMobile","$","browser","noder","finder","geom","styler","eventer","transforms","scrollingElement","oriented","touch","_getRect","el","adjustForTransform","container","adjustForFixed","getBoundingClientRect","window","top","left","bottom","right","width","height","boundingRect","matrix","scaleX","a","scaleY","d","ghostEl","PositionGhostAbsolutely","apple","device","ghostRelativeParent","ghostRelativeParentInitialScroll","_appendGhost","dragEl","options","this","rect","css","document","parentNode","ghostRelativeParentRect","body","documentElement","scrollTop","scrollLeft","autoscroll","_getRelativeScrollOffset","cloneNode","toggleClass","ghostClass","fallbackClass","dragClass","box-sizing","margin","opacity","position","zIndex","pointerEvents","appendChild","getRelativeScrollOffset","remove"],"mappings":";;;;;;;AAAAA,QACC,wBACA,sBACA,iCACA,gCACA,qBACA,uBACA,qBACA,sBACA,oBACA,sBACA,uBACA,0BACA,wCACA,gCACA,gCACC,SACDC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GAEG,aASH,SAASC,EAASC,EAAIC,EAAoBC,EAAWC,GACpD,GAAKH,EAAGI,uBAAyBJ,IAAOK,OAAxC,CACA,IAAIC,IACHA,EAAGC,KACHA,EAAIC,OACJA,EAAMC,MACNA,EAAKC,MACLA,EAAKC,OACLA,GACGnB,EAAKoB,aAAaZ,GAEtB,GAAIC,GAAsBD,IAAOK,OAAQ,CAExC,IAAIQ,EAASlB,EAAWkB,OAAOX,GAAaF,GAC3Cc,EAASD,GAAUA,EAAOE,EAC1BC,EAASH,GAAUA,EAAOI,EAEvBJ,IAOHL,GANAF,GAAOU,IAIPL,GAAUK,GAGVP,GANAF,GAAQO,IAERJ,GAASI,IAQX,OACCR,IAAKA,EACLC,KAAMA,EACNC,OAAQA,EACRC,MAAOA,EACPC,MAAOA,EACPC,OAAQA,IA6GV,OAvGCO,QAAU,KAEVC,wBAA0BhC,EAASiC,MAAMC,OAEzCC,oBAAsB,KACtBC,oCAEAC,aAAc,SAAUC,EAAOvB,EAAUwB,GAGxC,IACCR,EAAUS,KAAKT,QAEhB,IAAKA,EAAS,CACb,IACCU,EAAO7B,EAAS0B,GAAQ,EAAMvB,EAAYyB,KAAKR,yBACzC1B,EAAOoC,IAAIJ,GAIlB,GAAIE,KAAKR,wBAAyB,CAIjC,IAFA,IAAIG,EAAsBK,KAAKL,oBAAsBpB,EAGJ,WAAhDT,EAAOoC,IAAIP,EAAqB,aACiB,SAAjD7B,EAAOoC,IAAIP,EAAqB,cAChCA,IAAwBQ,UAExBR,EAAsBA,EAAoBS,WAG3C,GAAIT,IAAwBQ,SAAU,CACrC,IAAIE,EAA0BjC,EAASuB,GAAqB,GAE5DM,EAAKtB,KAAO0B,EAAwB1B,IACpCsB,EAAKrB,MAAQyB,EAAwBzB,KAGlCe,IAAwBQ,SAASG,MAAQX,IAAwBQ,SAASI,iBACzEZ,IAAwBQ,WAC3BR,EAAsBK,KAAKL,oBAAsB1B,KAGlDgC,EAAKtB,KAAOgB,EAAoBa,UAChCP,EAAKrB,MAAQe,EAAoBc,YAEjCd,EAAsBK,KAAKL,oBAAsB1B,IAElD2B,iCAAmCc,WAAWC,yBAAyBhB,GAIxEJ,EAASS,KAAKT,QAAUO,EAAOc,WAAU,GAEzC9C,EAAO+C,YAAYtB,EAASQ,EAAQe,YAAY,GAChDhD,EAAO+C,YAAYtB,EAASQ,EAAQgB,eAAe,GACnDjD,EAAO+C,YAAYtB,EAASQ,EAAQiB,WAAW,GAe/ClD,EAAOoC,IAAIX,GACV0B,aAAc,aACdC,OAAU,EACVvC,IAAOsB,EAAKtB,IACZC,KAAQqB,EAAKrB,KACbG,MAASkB,EAAKlB,MACdC,OAAUiB,EAAKjB,OACfmC,QAAW,MACXC,SAAapB,KAAKR,wBAA0B,WAAa,QACzD6B,OAAU,SACVC,cAAiB,SAElB/C,EAAUgD,YAAYhC,KAIxBiC,wBAA0B,WACzB,OAAOxB,KAAKR,yBAA2BQ,KAAKL,qBAAuBe,WAAWC,yBAAyBX,KAAKL,sBAG7G8B,OAAS,WACJzB,KAAKT,SACR5B,EAAM8D,OAAOzB,KAAKT,SAEnBS,KAAKT,QAAU","file":"../../fallback/ghoster.js","sourcesContent":["define([\r\n\t\"skylark-langx/skylark\",\r\n\t\"skylark-langx/langx\",\r\n\t\"skylark-langx-hoster/isBrowser\",\r\n\t\"skylark-langx-hoster/isMobile\",\r\n\t\"skylark-domx-query\",\r\n\t\"skylark-domx-browser\",\r\n\t\"skylark-domx-noder\",\r\n\t\"skylark-domx-finder\",\r\n\t\"skylark-domx-geom\",\r\n\t\"skylark-domx-styler\",\r\n\t\"skylark-domx-eventer\",\r\n\t\"skylark-domx-transforms\",\r\n\t\"skylark-domx-scrolls/scrollingElement\",\r\n\t\"skylark-domx-layouts/oriented\",\r\n\t\"skylark-devices-points/touch\"\r\n],function(\r\n\tskylark,\r\n\tlangx,\r\n\tisBrowser,\r\n\tisMobile,\r\n\t$,\r\n\tbrowser,\r\n\tnoder,\r\n\tfinder,\r\n\tgeom,\r\n\tstyler,\r\n\teventer,\r\n\ttransforms,\r\n\tscrollingElement,\r\n\toriented,\r\n\ttouch\r\n){\r\n    'use strict';\r\n\r\n\t/**\r\n\t * Returns the \"bounding client rect\" of given element\r\n\t * @param  {HTMLElement} el                The element whose boundingClientRect is wanted\r\n\t * @param  {[HTMLElement]} container       the parent the element will be placed in\r\n\t * @param  {[Boolean]} adjustForTransform  Whether the rect should compensate for parent's transform\r\n\t * @return {Object}                        The boundingClientRect of el\r\n\t */\r\n\tfunction _getRect(el, adjustForTransform, container, adjustForFixed) {\r\n\t\tif (!el.getBoundingClientRect && el !== window) return;\r\n\t\tvar {\r\n\t\t\ttop,\r\n\t\t\tleft,\r\n\t\t\tbottom,\r\n\t\t\tright,\r\n\t\t\twidth,\r\n\t\t\theight\r\n\t\t} = geom.boundingRect(el);\r\n\t\t\r\n\t\tif (adjustForTransform && el !== window) {\r\n\t\t\t// Adjust for scale()\r\n\t\t\tvar matrix = transforms.matrix(container || el),\r\n\t\t\t\tscaleX = matrix && matrix.a,\r\n\t\t\t\tscaleY = matrix && matrix.d;\r\n\r\n\t\t\tif (matrix) {\r\n\t\t\t\ttop /= scaleY;\r\n\t\t\t\tleft /= scaleX;\r\n\r\n\t\t\t\twidth /= scaleX;\r\n\t\t\t\theight /= scaleY;\r\n\r\n\t\t\t\tbottom = top + height;\r\n\t\t\t\tright = left + width;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttop: top,\r\n\t\t\tleft: left,\r\n\t\t\tbottom: bottom,\r\n\t\t\tright: right,\r\n\t\t\twidth: width,\r\n\t\t\theight: height\r\n\t\t};\r\n\t}\r\n\r\n\r\n\tvar ghoster = {\r\n\t\tghostEl : null,\r\n\r\n\t\tPositionGhostAbsolutely : isMobile.apple.device, //IOS\r\n\t\t// For positioning ghost absolutely\r\n\t\tghostRelativeParent : null,\r\n\t\tghostRelativeParentInitialScroll : [], // (left, top)\r\n\r\n\t\t_appendGhost: function (dragEl,container,options) {\r\n\t\t\t// Bug if using scale(): https://stackoverflow.com/questions/2637058\r\n\t\t\t// Not being adjusted for\r\n\t\t\tvar /// dragEl = dnd.dragEl,\r\n\t\t\t\tghostEl = this.ghostEl;\r\n\r\n\t\t\tif (!ghostEl) {\r\n\t\t\t\tvar ///container = this.options.fallbackOnBody ? document.body : rootEl,\r\n\t\t\t\t\trect = _getRect(dragEl, true, container, !this.PositionGhostAbsolutely),\r\n\t\t\t\t\tcss = styler.css(dragEl);\r\n\t\t\t\t\t///options = this.options;\r\n\r\n\t\t\t\t// Position absolutely\r\n\t\t\t\tif (this.PositionGhostAbsolutely) {\r\n\t\t\t\t\t// Get relatively positioned parent\r\n\t\t\t\t\tvar ghostRelativeParent = this.ghostRelativeParent = container;\r\n\r\n\t\t\t\t\twhile (\r\n\t\t\t\t\t\tstyler.css(ghostRelativeParent, 'position') === 'static' &&\r\n\t\t\t\t\t\tstyler.css(ghostRelativeParent, 'transform') === 'none' &&\r\n\t\t\t\t\t\tghostRelativeParent !== document\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tghostRelativeParent = ghostRelativeParent.parentNode;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (ghostRelativeParent !== document) {\r\n\t\t\t\t\t\tvar ghostRelativeParentRect = _getRect(ghostRelativeParent, true);\r\n\r\n\t\t\t\t\t\trect.top -= ghostRelativeParentRect.top;\r\n\t\t\t\t\t\trect.left -= ghostRelativeParentRect.left;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (ghostRelativeParent !== document.body && ghostRelativeParent !== document.documentElement) {\r\n\t\t\t\t\t\tif (ghostRelativeParent === document) {\r\n\t\t\t\t\t\t\tghostRelativeParent = this.ghostRelativeParent = scrollingElement();\r\n\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\trect.top += ghostRelativeParent.scrollTop;\r\n\t\t\t\t\t\trect.left += ghostRelativeParent.scrollLeft;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tghostRelativeParent = this.ghostRelativeParent = scrollingElement();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tghostRelativeParentInitialScroll = autoscroll._getRelativeScrollOffset(ghostRelativeParent);\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tghostEl =this.ghostEl = dragEl.cloneNode(true);\r\n\r\n\t\t\t\tstyler.toggleClass(ghostEl, options.ghostClass, false);\r\n\t\t\t\tstyler.toggleClass(ghostEl, options.fallbackClass, true);\r\n\t\t\t\tstyler.toggleClass(ghostEl, options.dragClass, true);\r\n\r\n\t\t\t\t/*\r\n\t\t\t\tstyler.css(ghostEl, 'box-sizing', 'border-box');\r\n\t\t\t\tstyler.css(ghostEl, 'margin', 0);\r\n\t\t\t\tstyler.css(ghostEl, 'top', rect.top);\r\n\t\t\t\tstyler.css(ghostEl, 'left', rect.left);\r\n\t\t\t\tstyler.css(ghostEl, 'width', rect.width);\r\n\t\t\t\tstyler.css(ghostEl, 'height', rect.height);\r\n\t\t\t\tstyler.css(ghostEl, 'opacity', '0.8');\r\n\t\t\t\tstyler.css(ghostEl, 'position', (this.PositionGhostAbsolutely ? 'absolute' : 'fixed'));\r\n\t\t\t\tstyler.css(ghostEl, 'zIndex', '100000');\r\n\t\t\t\tstyler.css(ghostEl, 'pointerEvents', 'none');\r\n\t\t\t\t*/\r\n\r\n\t\t\t\tstyler.css(ghostEl, {\r\n\t\t\t\t\t'box-sizing': 'border-box',\r\n\t\t\t\t\t'margin': 0,\r\n\t\t\t\t\t'top': rect.top,\r\n\t\t\t\t\t'left': rect.left,\r\n\t\t\t\t\t'width': rect.width,\r\n\t\t\t\t\t'height': rect.height,\r\n\t\t\t\t\t'opacity': '0.8',\r\n\t\t\t\t\t'position': (this.PositionGhostAbsolutely ? 'absolute' : 'fixed'),\r\n\t\t\t\t\t'zIndex': '100000',\r\n\t\t\t\t\t'pointerEvents': 'none'\t\r\n\t\t\t\t});\r\n\t\t\t\tcontainer.appendChild(ghostEl);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetRelativeScrollOffset : function(){\r\n\t\t\treturn this.PositionGhostAbsolutely && this.ghostRelativeParent && autoscroll._getRelativeScrollOffset(this.ghostRelativeParent);\r\n\t\t},\r\n\r\n\t\tremove : function() {\r\n\t\t\tif (this.ghostEl) {\r\n\t\t\t\tnoder.remove(this.ghostEl);\r\n\t\t\t} \r\n\t\t\tthis.ghostEl = null;\r\n\r\n\t\t}\r\n\r\n\r\n\t};\r\n\r\n\treturn ghoster;\r\n\t\r\n});"]}