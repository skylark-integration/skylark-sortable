{"version":3,"sources":["Draggable.js"],"names":["define","skylark","langx","isBrowser","isMobile","$","browser","noder","finder","geom","styler","eventer","transforms","scrollingElement","oriented","plugins","touch","autoscroll","containers","dnd","ghoster","lastDownEl","savedInputChecked","Plugin","inherit","klassName","pluginName","options","draggingClass","chosenClass","_construct","elm","this","overrided","el","_elm","fn","nativeDraggable","sortable","touchStartThreshold","charAt","bind","mousy","on","_onTapStart","evt","startIndex","startDraggableIndex","_this","preventOnFilter","type","touches","target","originalTarget","shadowRoot","path","composedPath","filter","root","length","inputs","getElementsByTagName","idx","checked","push","_saveInputCheckedState","dragEl","test","button","disabled","isContentEditable","closest","draggable","log","tagName","className","_index","call","_dispatchEvent","undefined","cancelable","preventDefault","split","some","criteria","trim","handle","_prepareDragStart","dragStartFn","rootEl","ownerDocument","oldIndex","parentEl","nextEl","oldDraggableIndex","tapEvt","parentNode","nextSibling","activeGroup","group","clientX","clientY","_lastX","_lastY","style","transition","transform","_triggerDragStart","toggleClass","ignore","forEach","ctx","iterator","list","i","n","_find","_disableDraggable","prepare","_onDragEnd","_onDragStart","document","selection","defer","empty","window","getSelection","removeAllRanges","err","fallback","dataTransfer","cloneEl","clone","_hideClone","_cloneId","removeCloneOnHide","insertBefore","dragClass","ignoreNextClick","_loopId","setInterval","_emulateDragOver","effectAllowed","setData","css","awaitingDragStarted","_dragStartId","_dragStarted","start","ghostClass","active","_appendGhost","_nulling","container","fallbackOnBody","body","cloneHidden","hide","remove","_showClone","putSortable","lastPutMode","contains","revertClone","appendChild","_animate","show","clearInterval","_clearAutoScrolls","_cancelThrottle","clearTimeout","_dragStartTimer","stop","off","end"],"mappings":"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","file":"../Draggable.js","sourcesContent":["define([\r\n    \"skylark-langx/skylark\",\r\n    \"skylark-langx/langx\",\r\n    \"skylark-langx-hoster/isBrowser\",\r\n    \"skylark-langx-hoster/isMobile\",\r\n    \"skylark-domx-query\",\r\n    \"skylark-domx-browser\",\r\n    \"skylark-domx-noder\",\r\n    \"skylark-domx-finder\",\r\n    \"skylark-domx-geom\",\r\n    \"skylark-domx-styler\",\r\n    \"skylark-domx-eventer\",\r\n    \"skylark-domx-transforms\",\r\n    \"skylark-domx-scrolls/scrollingElement\",\r\n    \"skylark-domx-layouts/oriented\",\r\n    \"skylark-domx-plugins\",\r\n    \"skylark-devices-points/touch\",\r\n    \"./autoscroll\",\r\n    \"./containers\",\r\n    \"./dnd\",\r\n    \"./ghoster\"\r\n],function(\r\n    skylark,\r\n    langx,\r\n    isBrowser,\r\n    isMobile,\r\n    $,\r\n    browser,\r\n    noder,\r\n    finder,\r\n    geom,\r\n    styler,\r\n    eventer,\r\n    transforms,\r\n    scrollingElement,\r\n    oriented,\r\n    plugins,\r\n    touch,\r\n    autoscroll,\r\n    containers,\r\n    dnd,\r\n    ghoster\r\n){\r\n\r\n    'use strict';\r\n\r\n    var \r\n        lastDownEl,\r\n        scrolling,\r\n\r\n        savedInputChecked = [];\r\n\r\n\r\n    function _find(ctx, tagName, iterator) {\r\n        if (ctx) {\r\n            var list = ctx.getElementsByTagName(tagName), i = 0, n = list.length;\r\n\r\n            if (iterator) {\r\n                for (; i < n; i++) {\r\n                    iterator(list[i], i);\r\n                }\r\n            }\r\n\r\n            return list;\r\n        }\r\n\r\n        return [];\r\n    }\r\n\r\n\r\n    function _saveInputCheckedState(root) {\r\n        savedInputChecked.length = 0;\r\n\r\n        var inputs = root.getElementsByTagName('input');\r\n        var idx = inputs.length;\r\n\r\n        while (idx--) {\r\n            var el = inputs[idx];\r\n            el.checked && savedInputChecked.push(el);\r\n        }\r\n    }\r\n\r\n\r\n    var Draggable = plugins.Plugin.inherit({\r\n        klassName: \"Draggable\",\r\n        \r\n        pluginName : \"intg.sortable.draggable\",\r\n\r\n        options : {\r\n            draggingClass : \"dragging\",\r\n            chosenClass : null\r\n\r\n        },\r\n\r\n        _construct: function(elm, options) {\r\n            this.overrided(elm,options);\r\n            var el = this._elm;\r\n\r\n            // Setup drag mode\r\n            this.nativeDraggable = options.nativeDraggable;\r\n            this.sortable = options.sortable;\r\n\r\n            if (this.nativeDraggable) {\r\n                // Touch start threshold cannot be greater than the native dragstart threshold\r\n                this.options.touchStartThreshold = 1;\r\n            }\r\n\r\n\r\n            // Bind all private methods\r\n            for (var fn in this) {\r\n                if (fn.charAt(0) === '_' && typeof this[fn] === 'function') {\r\n                    this[fn] = this[fn].bind(this);\r\n                }\r\n            }\r\n\r\n\r\n            // Bind events\r\n            touch.mousy(el);\r\n            eventer.on(el, 'mousedown', this._onTapStart);\r\n\r\n        },\r\n\r\n        // handle moudedown event\r\n        _onTapStart: function (/** Event|TouchEvent */evt) {\r\n            //if (!evt.cancelable) return;\r\n            var _this = this,\r\n                el = this._elm,\r\n                options = this.options,\r\n                preventOnFilter = options.preventOnFilter,\r\n                type = evt.type,\r\n                touch = evt.touches && evt.touches[0],\r\n                target = (touch || evt).target,\r\n                originalTarget = evt.target.shadowRoot && ((evt.path && evt.path[0]) || (evt.composedPath && evt.composedPath()[0])) || target,\r\n                filter = options.filter,\r\n                startIndex,\r\n                startDraggableIndex;\r\n\r\n            _saveInputCheckedState(el);\r\n\r\n            // Don't trigger start event when an element is been dragged, otherwise the evt.oldindex always wrong when set option.group.\r\n            if (dnd.dragEl) {\r\n                return;\r\n            }\r\n\r\n            if (/mousedown|pointerdown/.test(type) && evt.button !== 0 || options.disabled) {\r\n                return; // only left button and enabled\r\n            }\r\n\r\n            // cancel dnd if original target is content editable\r\n            if (originalTarget.isContentEditable) {\r\n                return;\r\n            }\r\n\r\n            target = finder.closest(target, options.draggable, el, false);\r\n\r\n\r\n            if (lastDownEl === target) {\r\n                // Ignoring duplicate `down`\r\n                return;\r\n            }\r\n\r\n            dnd.log(\"_onTapStart\",target.tagName+\",\"+target.className);\r\n\r\n            // Get the index of the dragged element within its parent\r\n            startIndex = containers._index(target);\r\n            startDraggableIndex = containers._index(target, options.draggable);\r\n\r\n            // Check filter\r\n            if (typeof filter === 'function') {\r\n                if (filter.call(this, evt, target, this)) {\r\n                    dnd._dispatchEvent(_this, originalTarget, 'filter', target, el, el, startIndex, undefined, startDraggableIndex);\r\n                    preventOnFilter && evt.cancelable && evt.preventDefault();\r\n                    return; // cancel dnd\r\n                }\r\n            }\r\n            else if (filter) {\r\n                filter = filter.split(',').some(function (criteria) {\r\n                    criteria = finder.closest(originalTarget, criteria.trim(), el, false);\r\n\r\n                    if (criteria) {\r\n                        dnd._dispatchEvent(_this, criteria, 'filter', target, el, el, startIndex, undefined, startDraggableIndex);\r\n                        return true;\r\n                    }\r\n                });\r\n\r\n                if (filter) {\r\n                    preventOnFilter && evt.cancelable && evt.preventDefault();\r\n                    return; // cancel dnd\r\n                }\r\n            }\r\n\r\n            if (options.handle && !finder.closest(originalTarget, options.handle, el, false)) {\r\n                return;\r\n            }\r\n\r\n            // Prepare `dragstart`\r\n            this._prepareDragStart(evt, touch, target, startIndex, startDraggableIndex);\r\n        },\r\n\r\n        _prepareDragStart: function (/** Event */evt, /** Touch */touch, /** HTMLElement */target, /** Number */startIndex, /** Number */startDraggableIndex) {\r\n            var _this = this,\r\n                el = _this._elm,\r\n                options = _this.options,\r\n                ownerDocument = el.ownerDocument,\r\n                dragStartFn,\r\n                dragEl = dnd.dragEl,\r\n                rootEl,\r\n                parentEl = dnd.parentEl,\r\n                nextEl = dnd.nextEl,\r\n                oldIndex = dnd.oldIndex,\r\n                oldDraggableIndex = dnd.oldDraggableIndex,\r\n                tapEvt = dnd.tapEvt;\r\n\r\n            dnd.log(\"_prepareDragStart\",\"start\");\r\n            if (target && !dragEl && (target.parentNode === el)) {\r\n                rootEl = el;\r\n                dragEl = dnd.dragEl = target;\r\n                parentEl = dnd.parentEl= dragEl.parentNode;\r\n                nextEl = dnd.nextEl = dragEl.nextSibling;\r\n                lastDownEl = target;\r\n                dnd.activeGroup = this.sortable.options.group;\r\n                oldIndex = dnd.oldIndex = startIndex;\r\n                oldDraggableIndex = dnd.oldDraggableIndex =  startDraggableIndex;\r\n\r\n                tapEvt = dnd.tapEvt = {\r\n                    target: dragEl,\r\n                    clientX: (touch || evt).clientX,\r\n                    clientY: (touch || evt).clientY\r\n                };\r\n\r\n                this._lastX = (touch || evt).clientX;\r\n                this._lastY = (touch || evt).clientY;\r\n\r\n                dragEl.style['will-change'] = 'all';\r\n                // undo animation if needed\r\n                dragEl.style.transition = '';\r\n                dragEl.style.transform = '';\r\n\r\n                dragStartFn = function () {\r\n                    if ( _this.nativeDraggable) {\r\n                        dragEl.draggable = true;\r\n                    }\r\n\r\n                    // Bind the events: dragstart/dragend\r\n                    _this._triggerDragStart(evt, touch);\r\n\r\n                    // Drag start event\r\n                    dnd._dispatchEvent(_this, rootEl, 'choose', dragEl, rootEl, rootEl, oldIndex, undefined, oldDraggableIndex);\r\n\r\n                    // Chosen item\r\n                    styler.toggleClass(dragEl, options.chosenClass, true);\r\n                };\r\n\r\n                // Disable \"draggable\"\r\n                options.ignore.split(',').forEach(function (criteria) {\r\n                    _find(dragEl, criteria.trim(), dnd._disableDraggable);\r\n                });\r\n\r\n                //eventer.on(ownerDocument, 'mouseup', _this._onDrop); // TODO : lwf\r\n                ///eventer.on(ownerDocument, 'touchend', _this._onDrop);\r\n                ///eventer.on(ownerDocument, 'touchcancel', _this._onDrop);\r\n\r\n                // Make dragEl draggable (must be before delay for FireFox)\r\n                ///if (FireFox && this.nativeDraggable) {\r\n                if (this.nativeDraggable) {\r\n                   this.options.touchStartThreshold = 4;\r\n                    dragEl.draggable = true;\r\n                }\r\n\r\n                dragStartFn();\r\n            }\r\n        },\r\n\r\n        //native dnd mode : register _OnDragStart for dragstart event handler \r\n        //moused dnd mode : register  _onTouchMove for mousemove event hander, _onTouchMove calls _OnDragStart\r\n        _triggerDragStart: function (/** Event */evt, /** Touch */touch) {\r\n            dnd.log(\"_triggerDragStart\",\"start\");\r\n            dnd.log(\"_triggerDragStart\",\"nativeDraggable is \" +  this.nativeDraggable);\r\n\r\n            dnd.prepare(this);\r\n\r\n            if (!this.nativeDraggable) {\r\n                ////eventer.on(document, 'mousemove', this._onTouchMove);\r\n            } else {\r\n                eventer.on(dnd.dragEl, 'dragend', this._onDragEnd);\r\n                eventer.on(dnd.dragEl, 'dragstart', this._onDragStart);\r\n            }\r\n\r\n            try {\r\n                if (document.selection) {\r\n                    // Timeout neccessary for IE9\r\n                    langx.defer(function () {\r\n                        document.selection.empty();\r\n                    });\r\n                } else {\r\n                    window.getSelection().removeAllRanges();\r\n                }\r\n            } catch (err) {\r\n            }\r\n        },\r\n\r\n        _onDragStart: function (/**Event*/evt, /**boolean*/fallback) {\r\n            var _this = this,\r\n                dragEl = dnd.dragEl,\r\n                rootEl = this._elm;\r\n\r\n            var dataTransfer = evt.dataTransfer;\r\n            var options = _this.options;\r\n\r\n            // Setup clone\r\n            var cloneEl = dnd.cloneEl = noder.clone(dragEl,true);\r\n\r\n            cloneEl.draggable = false;\r\n            cloneEl.style['will-change'] = '';\r\n\r\n            this._hideClone();\r\n\r\n            styler.toggleClass(cloneEl, _this.options.chosenClass, false);\r\n\r\n\r\n            // #1143: IFrame support workaround\r\n            _this._cloneId = langx.defer(function () {\r\n                if (!_this.options.removeCloneOnHide) {\r\n                    rootEl.insertBefore(cloneEl, dragEl);\r\n                }\r\n                dnd._dispatchEvent(_this, rootEl, 'clone', dragEl);\r\n            });\r\n\r\n\r\n            !fallback && styler.toggleClass(dragEl, options.dragClass, true);\r\n\r\n            // Set proper drop events\r\n            if (fallback) {\r\n                dnd.ignoreNextClick = true;\r\n                _this._loopId = setInterval(dnd._emulateDragOver.bind(dnd), 50);\r\n            } else {\r\n                // Undo what was set in _prepareDragStart before drag started\r\n                //eventer.off(document, 'mouseup', _this._onDrop); //TODO : lwf\r\n                ///eventer.off(document, 'touchend', _this._onDrop);\r\n                ///eventer.off(document, 'touchcancel', _this._onDrop);\r\n\r\n                if (dataTransfer) {\r\n                    dataTransfer.effectAllowed = 'move';\r\n                    options.setData && options.setData.call(_this, dataTransfer, dragEl);\r\n                }\r\n\r\n                ////eventer.on(document, 'drop', _this);\r\n\r\n                // #1276 fix:\r\n                styler.css(dragEl, 'transform', 'translateZ(0)');\r\n            }\r\n\r\n            dnd.awaitingDragStarted = true;\r\n\r\n            _this._dragStartId = langx.defer(_this._dragStarted.bind(_this, fallback, evt));\r\n            ///eventer.on(document, 'selectstart', _this);\r\n            ///if (Safari) {\r\n            ///    styler.css(document.body, 'user-select', 'none');\r\n            ///}\r\n        },\r\n\r\n        //\r\n        //\r\n        _dragStarted: function (fallback, evt) {\r\n            dnd.awaitingDragStarted = false;\r\n            var dragEl = dnd.dragEl,\r\n                rootEl = this._elm,\r\n                oldIndex = dnd.oldIndex,\r\n                oldDraggableIndex = dnd.oldDraggableIndex;\r\n\r\n            if (rootEl && dragEl) {\r\n                //if (this.nativeDraggable) {\r\n                //    eventer.on(document, 'dragover', this._handleAutoScroll);\r\n                //    eventer.on(document, 'dragover', dnd._checkAlignment);\r\n                //}\r\n                dnd.start(this);\r\n                var options = this.options;\r\n\r\n                // Apply effect\r\n                !fallback && styler.toggleClass(dragEl, options.dragClass, false);\r\n                styler.toggleClass(dragEl, options.ghostClass, true);\r\n\r\n                // In case dragging an animated element\r\n                styler.css(dragEl, 'transform', '');\r\n\r\n                dnd.active = this.sortable;\r\n\r\n                fallback && this._appendGhost();\r\n\r\n                // Drag start event\r\n                dnd._dispatchEvent(this, rootEl, 'start', dragEl, rootEl, rootEl, oldIndex, undefined, oldDraggableIndex, undefined, evt);\r\n            } else {\r\n                this._nulling();\r\n            }\r\n        },\r\n\r\n        _appendGhost: function () {\r\n            // Bug if using scale(): https://stackoverflow.com/questions/2637058\r\n            // Not being adjusted for\r\n            var rootEl =  this.elm();\r\n            var container = this.options.fallbackOnBody ? document.body : rootEl;\r\n            return ghoster._appendGhost(dnd.dragEl,container,this.options);\r\n        },\r\n\r\n\r\n\r\n        _nulling: function() {\r\n            lastDownEl = null;\r\n\r\n            savedInputChecked.forEach(function (el) {\r\n                el.checked = true;\r\n            });\r\n\r\n\r\n            savedInputChecked.length = 0;\r\n\r\n        },\r\n\r\n        _hideClone: function() {\r\n            if (!dnd.cloneEl.cloneHidden) {\r\n                styler.hide(dnd.cloneEl);\r\n                dnd.cloneEl.cloneHidden = true;\r\n                if (dnd.cloneEl.parentNode && this.options.removeCloneOnHide) {\r\n                    noder.remove(dnd.cloneEl);\r\n                }\r\n            }\r\n        },\r\n\r\n        _showClone: function(putSortable) {\r\n            var rootEl = dnd.active.el,\r\n                nextEl = dnd.nextEl;\r\n\r\n            if (putSortable.lastPutMode !== 'clone') {\r\n                this._hideClone();\r\n                return;\r\n            }\r\n\r\n            if (dnd.cloneEl.cloneHidden) {\r\n                // show clone at dragEl or original position\r\n                if (rootEl.contains(dnd.dragEl) && !this.options.group.revertClone) {\r\n                    rootEl.insertBefore(dnd.cloneEl, dnd.dragEl);\r\n                } else if (nextEl) {\r\n                    rootEl.insertBefore(dnd.cloneEl, nextEl);\r\n                } else {\r\n                    rootEl.appendChild(dnd.cloneEl);\r\n                }\r\n\r\n                if (this.options.group.revertClone) {\r\n                    this._animate(dnd.dragEl, dnd.cloneEl);\r\n                }\r\n                styler.show(dnd.cloneEl);\r\n                dnd.cloneEl.cloneHidden = false;\r\n            }\r\n        },\r\n\r\n        _onDragEnd: function (/**Event*/evt) {\r\n            var el = this._elm,\r\n                options = this.options,\r\n                dragEl = dnd.dragEl,\r\n                putSortable = dnd.putSortable;\r\n\r\n            dnd.awaitingDragStarted = false;\r\n            scrolling = false;\r\n            //isCircumstantialInvert = false;\r\n            //pastFirstInvertThresh = false;\r\n\r\n            clearInterval(this._loopId);\r\n\r\n            //clearInterval(pointerElemChangedInterval);\r\n            autoscroll._nulling();\r\n            \r\n            autoscroll._clearAutoScrolls();\r\n            autoscroll._cancelThrottle();\r\n\r\n            clearTimeout(this._dragStartTimer);\r\n\r\n\r\n            if (this._cloneId) {\r\n                this._cloneId.stop();\r\n                this._cloneId = null;\r\n            }\r\n\r\n            if (this._dragStartId) {\r\n                this._dragStartId.stop();\r\n                this._dragStartId = null;\r\n            }\r\n\r\n            // Unbind events\r\n            ///eventer.off(document, 'mousemove', this._onTouchMove);\r\n\r\n\r\n\r\n            ///if (Safari) {\r\n            ///    styler.css(document.body, 'user-select', '');\r\n           /// }\r\n\r\n\r\n\r\n            if (this.nativeDraggable) {\r\n                eventer.off(dnd.dragEl, 'dragstart', this._onDragStart);\r\n                eventer.off(dnd.dragEl, 'dragend', this._onDragEnd);\r\n            }\r\n            dnd.end();\r\n            this._nulling();\r\n\r\n        }\r\n\r\n    });\r\n\r\n\r\n    return Draggable;\r\n\r\n});"]}