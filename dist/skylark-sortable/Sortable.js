/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-langx-hoster/is-browser","skylark-langx-hoster/is-mobile","skylark-domx-query","skylark-domx-browser","skylark-domx-noder","skylark-domx-finder","skylark-domx-geom","skylark-domx-styler","skylark-domx-eventer","skylark-domx-transforms","skylark-domx-plugins-scrolls/scrolling-element","skylark-domx-layouts/oriented","skylark-domx-plugins-base","skylark-devices-points/touch","./dnd","./draggable"],function(t,e,n,o,i,r,l,a,s,d,c,h,u,g,p,f,v,b){"use strict";function m(t,e){return a.index(t,function(t){return!("TEMPLATE"===t.nodeName.toUpperCase()||t===v.cloneEl||e&&!a.matches(t,e))})}var E,x,k,_,y,C,w,D=!1,S=!1,T=window,I=T.document,R=T.parseInt,A=T.setTimeout,P=(T.Polymer,n&&n.ie,n&&n.edge,n&&n.firefox,n&&n.safari,o&&o.apple.device,"draggable"in I.createElement("div")&&!o.apple.device),M=(r.support.cssPointerEvents,!1),N=!1,O=function(t){function e(t,n){return function(o,i,r,l){var a=o.options.group.name&&i.options.group.name&&o.options.group.name===i.options.group.name;if(null==t&&(n||a))return!0;if(null==t||!1===t)return!1;if(n&&"clone"===t)return t;if("function"==typeof t)return e(t(o,i,r,l),n)(o,i,r,l);var s=(n?o:i).options.group.name;return!0===t||"string"==typeof t&&t===s||t.join&&t.indexOf(s)>-1}}var n={},o=t.group;o&&"object"==typeof o||(o={name:o}),n.name=o.name,n.checkPull=e(o.pull,!0),n.checkPut=e(o.put),n.revertClone=o.revertClone,t.group=n},B=p.Plugin.inherit({klassName:"Sortable",pluginName:"intg.sortable",options:{group:null,sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0,swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(t,n,o,i){return g(this.el,e.mixin({excluding:[i,o]},this.options))},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:R(window.devicePixelRatio,10)||1,fallbackOnBody:!0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackTolerance:0,fallbackOffset:{x:0,y:0},emptyInsertThreshold:5},_construct:function(t,e){for(var n in this.overrided(t,e),this.el=t,t[v.expando]=this,(e=this.options).draggable=e.draggable||/[uo]l/i.test(t.nodeName)?">li":">*",O(e),this)"_"===n.charAt(0)&&"function"==typeof this[n]&&(this[n]=this[n].bind(this));this.nativeDraggable=!e.forceFallback&&P,this.nativeDraggable&&(this.options.touchStartThreshold=1),this.nativeDraggable&&(c.on(t,"dragover",this),c.on(t,"dragenter",this),c.on(t,"drop",this)),v.sortables.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),this.draggable=new b(this,this.options),c.on(t,"selectstart",this)},_onMove:function(t,e,n,o,i,r,l,a){var d,h,u=t[v.expando],g=u.options.onMove;return d=c.create("move",{to:e,from:t,dragged:n,draggedRect:o,related:i||e,relatedRect:r||s.boundingRect(e),willInsertAfter:a,originalEvent:l}),t.dispatchEvent(d),g&&(h=g.call(u,d,l)),h},_computeIsAligned:function(t){var e,n=v.dragEl;if(e=t.target,e=a.closest(e,this.options.draggable,this.el,!1),!N&&n&&n.parentNode===this.el){for(var o,i,r,l,d,c,h,u,g=this.el.children,p=0;p<g.length;p++)a.closest(g[p],this.options.draggable,this.el,!1)&&g[p]!==e&&(g[p].sortableMouseAligned=(o=t.clientX,i=t.clientY,r=g[p],l=this._getDirection(t,null),this.options,void 0,void 0,void 0,void 0,d=s.boundingRect(r),c="vertical"===l?d.left:d.top,h="vertical"===l?d.right:d.bottom,c<(u="vertical"===l?o:i)&&u<h));a.closest(e,this.options.draggable,this.el,!0)||(_=null),N=!0,A(function(){N=!1},30)}},_getDirection:function(t,e){var n=v.dragEl;return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,n,null):this.options.direction},_animate:function(t,e){var n=this.options.animation,o=v.dragEl;if(n){var i=s.boundingRect(e);if(e===o&&i,1===t.nodeType&&(t=s.boundingRect(t)),t.left+t.width/2!==i.left+i.width/2||t.top+t.height/2!==i.top+i.height/2){var r=h.matrix(this.el),l=r&&r.a,a=r&&r.d;d.css(e,"transition","none"),d.css(e,"transform","translate3d("+(t.left-i.left)/(l||1)+"px,"+(t.top-i.top)/(a||1)+"px,0)"),this._repaint(e),d.css(e,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),d.css(e,"transform","translate3d(0,0,0)")}"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=A(function(){d.css(e,"transition",""),d.css(e,"transform",""),e.animated=!1},n)}},_repaint:function(t){return t.offsetWidth},_offUpEvents:function(){var t=this.el.ownerDocument;c.off(t,"mouseup",this._onDrop),c.off(I,"selectstart",this)},_onDragOver:function(t){var e,n,o,i=this.el,r=t.target,l=this.options,c=l.group,h=v.active,u=v.activeGroup===c,g=l.sort,p=this,f=v.dragEl,b=v.active.elm(),E=v.putSortable,x=v.nextEl,T=v.oldIndex,R=v.oldDraggableIndex;if(!M){if(void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),k=!0,r=a.closest(r,l.draggable,i,!0),f.contains(t.target)||r.animated)return G(!1);if(h&&!l.disabled&&(u?g||(o=!b.contains(f)):E===this||(this.lastPutMode=v.activeGroup.checkPull(this,h,f,t))&&c.checkPut(this,h,f,t))){var P=this._getDirection(t,r);if(e=s.boundingRect(f),o)return this._hideClone(),v.parentEl=b,x?b.insertBefore(f,x):b.appendChild(f),G(!0);var N=function(t){return a.lastChild(t,{ignoreHidden:!0,excluding:[]})}(i);if(!N||function(t,e,n){var o=s.boundingRect(a.lastChild(n,{ignoreHidden:!0,excluding:[]})),i="vertical"===e?t.clientY:t.clientX,r="vertical"===e?t.clientX:t.clientY,l="vertical"===e?o.bottom:o.right,d="vertical"===e?o.left:o.top,c="vertical"===e?o.right:o.bottom;return"vertical"===e?r>c+10||r<=c&&i>l&&r>=d:i>l&&r>d||i<=l&&r>c+10}(t,P,i)&&!N.animated){if(N&&i===t.target&&(r=N),r&&(n=s.boundingRect(r)),u?h._hideClone():h._showClone(this),!1!==this._onMove(b,i,f,e,r,n,t,!!r))return i.appendChild(f),v.parentEl=i,null,L(),G(!0)}else if(r&&r!==f&&r.parentNode===i){var O,B=0,U=r.sortableMouseAligned,X=f.parentNode!==i,Y="vertical"===P?"top":"left";if(_!==r&&(C=null,O=s.boundingRect(r)[Y],D=!1),function(t,e,n){var o=s.boundingRect(t),i=s.boundingRect(e),r="vertical"===n?o.left:o.top,l="vertical"===n?o.right:o.bottom,a="vertical"===n?o.width:o.height,d="vertical"===n?i.left:i.top,c="vertical"===n?i.right:i.bottom,h="vertical"===n?i.width:i.height;return r===d||l===c||r+a/2===d+h/2}(f,r,P)&&U||X||l.invertSwap||"insert"===C||"swap"===C?("swap"!==C&&(S=l.invertSwap||X),B=function(t,e,n,o,i,r,l){var a=s.boundingRect(e),d="vertical"===n?t.clientY:t.clientX,c="vertical"===n?a.height:a.width,h="vertical"===n?a.top:a.left,u="vertical"===n?a.bottom:a.right,g=s.boundingRect(f),p=!1;if(!r)if(l&&w<c*o){if(!D&&(1===y?d>h+c*i/2:d<u-c*i/2)&&(D=!0),D)p=!0;else if("vertical"===n?g.top:g.left,"vertical"===n?g.bottom:g.right,1===y?d<h+w:d>u-w)return-1*y}else if(d>h+c*(1-o)/2&&d<u-c*(1-o)/2)return W(e);return(p=p||r)&&(d<h+c*i/2||d>u-c*i/2)?d>h+c/2?1:-1:0}(t,r,P,l.swapThreshold,null==l.invertedSwapThreshold?l.swapThreshold:l.invertedSwapThreshold,S,_===r),C="swap"):(B=W(r),C="insert"),0===B)return G(!1);null,_=r,y=B,n=s.boundingRect(r);var F=r.nextElementSibling,j=!1;j=1===B;var q=this._onMove(b,i,f,e,r,n,t,j);if(!1!==q)return 1!==q&&-1!==q||(j=1===q),M=!0,A(H,30),u?h._hideClone():h._showClone(this),j&&!F?i.appendChild(f):r.parentNode.insertBefore(f,j?F:r),v.parentEl=f.parentNode,void 0===O||S||(w=Math.abs(O-s.boundingRect(r)[Y])),L(),G(!0)}if(i.contains(f))return G(!1)}return!1}function G(o){return o&&(u?h._hideClone():h._showClone(p),h&&(d.toggleClass(f,E?E.options.ghostClass:h.options.ghostClass,!1),d.toggleClass(f,l.ghostClass,!0)),E!==p&&p!==v.active?E=v.putSortable=p:p===v.active&&(E=v.putSortable=null),e&&p._animate(e,f),r&&n&&p._animate(n,r)),(r===f&&!f.animated||r===i&&!r.animated)&&(_=null),l.dragoverBubble||t.rootEl||r===I||(v.over(t),f.parentNode[v.expando]._computeIsAligned(t),!o&&v.nearestEmptyInsertDetectEvent(t)),!l.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),!0}function L(){p._dispatchEvent(p,b,"change",r,i,b,T,m(f),R,m(f,l.draggable),t)}function W(t){return m(f)<m(t)?1:-1}},_onDrop:function(t){this.el;var e=this.options,n=v.active.elm(),o=v.dragEl,i=v.putSortable,r=v.parentEl,a=v.oldIndex,s=v.oldDraggableIndex,h=v.nextEl;S=!1,D=!1,this.nativeDraggable&&c.off(I,"drop",this),this._offUpEvents(),t&&(k&&(t.cancelable&&t.preventDefault(),!e.dropBubble&&t.stopPropagation()),(n===r||i&&"clone"!==i.lastPutMode)&&l.remove(v.cloneEl),o&&(v._disableDraggable(o),o.style["will-change"]="",d.toggleClass(o,i?i.options.ghostClass:this.options.ghostClass,!1),d.toggleClass(o,this.options.chosenClass,!1),this._dispatchEvent(this,n,"unchoose",o,r,n,a,null,s,null,t),n!==r?(E=m(o),x=m(o,e.draggable),E>=0&&(this._dispatchEvent(null,r,"add",o,r,n,a,E,s,x,t),this._dispatchEvent(this,n,"remove",o,r,n,a,E,s,x,t),this._dispatchEvent(null,r,"sort",o,r,n,a,E,s,x,t),this._dispatchEvent(this,n,"sort",o,r,n,a,E,s,x,t)),i&&i.save()):o.nextSibling!==h&&(E=m(o),x=m(o,e.draggable),E>=0&&(this._dispatchEvent(this,n,"update",o,r,n,a,E,s,x,t),this._dispatchEvent(this,n,"sort",o,r,n,a,E,s,x,t))),v.active&&(null!=E&&-1!==E||(E=a,x=s),this._dispatchEvent(this,n,"end",o,r,n,a,E,s,x,t),this.save()))),this._nulling()},_nulling:function(){k=E=_=y=null},_hideClone:function(){v.cloneEl.cloneHidden||(d.hide(v.cloneEl),v.cloneEl.cloneHidden=!0,v.cloneEl.parentNode&&this.options.removeCloneOnHide&&l.remove(v.cloneEl))},_showClone:function(t){var e=v.active.el,n=v.nextEl;"clone"===t.lastPutMode?v.cloneEl.cloneHidden&&(e.contains(v.dragEl)&&!this.options.group.revertClone?e.insertBefore(v.cloneEl,v.dragEl):n?e.insertBefore(v.cloneEl,n):e.appendChild(v.cloneEl),this.options.group.revertClone&&this._animate(v.dragEl,v.cloneEl),d.show(v.cloneEl),v.cloneEl.cloneHidden=!1):this._hideClone()},handleEvent:function(t){switch(t.type){case"drop":this._onDrop(t);break;case"dragenter":case"dragover":v.dragEl&&(this._onDragOver(t),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move");t.cancelable&&t.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},_dispatchEvent:function(t,e,n,o,i,r,l,a,s,d,h){var u,g=(t=t||e[v.expando]).options,p="on"+n.charAt(0).toUpperCase()+n.substr(1),f=v.putSortable;u=c.create(n,{to:i||e,from:r||e,item:o||e,clone:v.cloneEl,oldIndex:l,newIndex:a,oldDraggableIndex:s,newDraggableIndex:d,originalEvent:h,pullMode:f?f.lastPutMode:void 0}),e&&e.dispatchEvent(u),g[p]&&g[p].call(t,u)},toArray:function(){for(var t,e=[],n=this.el.children,o=0,i=n.length,r=this.options;o<i;o++)t=n[o],a.closest(t,r.draggable,this.el,!1)&&e.push(t.getAttribute(r.dataIdAttr)||l.generateId(t));return e},sort:function(t){var e={},n=this.el;this.toArray().forEach(function(t,o){var i=n.children[o];a.closest(i,this.options.draggable,n,!1)&&(e[t]=i)},this),t.forEach(function(t){e[t]&&(n.removeChild(e[t]),n.appendChild(e[t]))})},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return a.closest(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var n=this.options;if(void 0===e)return n[t];n[t]=e,"group"===t&&O(n)},destroy:function(){var t=this.el;t[v.expando]=null,c.off(t,"mousedown",this._onTapStart),this.nativeDraggable&&(c.off(t,"dragover",this),c.off(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),v.sortables.splice(v.sortables.indexOf(this.el),1),this.el=t=null}});function H(){M=!1}return B.create=function(t,e){return new B(t,e)},B.version="1.9.0",t.attach("intg.Sortable",B)});
//# sourceMappingURL=sourcemaps/Sortable.js.map
