/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-langx-hoster/isBrowser","skylark-langx-hoster/isMobile","skylark-domx-query","skylark-domx-browser","skylark-domx-noder","skylark-domx-finder","skylark-domx-geom","skylark-domx-styler","skylark-domx-eventer","skylark-domx-transforms","skylark-domx-scrolls/scrollingElement","skylark-domx-layouts/oriented","skylark-devices-points/touch","./autoscroll","./containers","./dnd","./ghoster"],function(t,e,n,o,a,r,i,s,l,c,d,h,g,u,p,f,v,m,_){function b(t,e){a("#console").append("<div>"+t+":"+e+"</div>")}var E,y,D,S,C,k,x,w,T,I,P,A,M,N,O,R,B=!1,X=!1,Y=!1,H=!1,G=window,F=G.document,L=G.parseInt,j=G.setTimeout,q=(G.Polymer,n&&n.ie),U=n&&n.edge,z=n&&n.firefox,W=n&&n.safari,Z=(o&&o.apple.device,"draggable"in F.createElement("div")&&!o.apple.device);r.support.cssPointerEvents;function J(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,o=0;n--;)o+=e.charCodeAt(n);return o.toString(36)}function K(t){return e.defer(t)}function Q(t){return t&&t.stop()}function V(t,n){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be HTMLElement, not "+{}.toString.call(t);this.el=t,this.options=n=e.mixin({},n),t[m.expando]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0,draggable:/[uo]l/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(n,o,a,r){return u(t,e.mixin({excluding:[r,a]},this.options))},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:L(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==V.supportPointer&&"PointerEvent"in window,emptyInsertThreshold:5};for(var a in o)!(a in n)&&(n[a]=o[a]);for(var r in _prepareGroup(n),this)"_"===r.charAt(0)&&"function"==typeof this[r]&&(this[r]=this[r].bind(this));this.nativeDraggable=!n.forceFallback&&Z,this.nativeDraggable&&(this.options.touchStartThreshold=1),p.mousy(t),d.on(t,"mousedown",this._onTapStart),this.nativeDraggable&&(d.on(t,"dragover",this),d.on(t,"dragenter",this)),m.sortables.push(this.el),n.store&&n.store.get&&this.sort(n.store.get(this)||[])}function $(t){t.draggable=!1}function tt(){_silent=!1}return _silent=!1,_alignedSilent=!1,abs=Math.abs,min=Math.min,max=Math.max,savedInputChecked=[],_prepareGroup=function(t){function e(t,n){return function(o,a,r,i){var s=o.options.group.name&&a.options.group.name&&o.options.group.name===a.options.group.name;if(null==t&&(n||s))return!0;if(null==t||!1===t)return!1;if(n&&"clone"===t)return t;if("function"==typeof t)return e(t(o,a,r,i),n)(o,a,r,i);var l=(n?o:a).options.group.name;return!0===t||"string"==typeof t&&t===l||t.join&&t.indexOf(l)>-1}}var n={},o=t.group;o&&"object"==typeof o||(o={name:o}),n.name=o.name,n.checkPull=e(o.pull,!0),n.checkPut=e(o.put),n.revertClone=o.revertClone,t.group=n},F.addEventListener("click",function(t){if(X)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),X=!1,!1},!0),d.on(F,"touchmove",function(t){(V.active||B)&&t.cancelable&&t.preventDefault()}),V.prototype={constructor:V,_computeIsAligned:function(t){var e,n=m.dragEl;if(e=t.target,e=s.closest(e,this.options.draggable,this.el,!1),!_alignedSilent&&n&&n.parentNode===this.el){for(var o=this.el.children,a=0;a<o.length;a++)s.closest(o[a],this.options.draggable,this.el,!1)&&o[a]!==e&&(o[a].sortableMouseAligned=v._isClientInRowColumn(t.clientX,t.clientY,o[a],this._getDirection(t,null),this.options));s.closest(e,this.options.draggable,this.el,!0)||(M=null),_alignedSilent=!0,j(function(){_alignedSilent=!1},30)}},_getDirection:function(t,e){var n=m.dragEl;return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,n,_.ghostEl):this.options.direction},_onTapStart:function(t){var e,n,o=this,a=this.el,r=this.options,i=r.preventOnFilter,l=t.type,c=t.touches&&t.touches[0],d=(c||t).target,h=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||d,g=r.filter;if(function(t){savedInputChecked.length=0;for(var e=t.getElementsByTagName("input"),n=e.length;n--;){var o=e[n];o.checked&&savedInputChecked.push(o)}}(a),!m.dragEl&&!(/mousedown|pointerdown/.test(l)&&0!==t.button||r.disabled||h.isContentEditable||(d=s.closest(d,r.draggable,a,!1),S===d))){if(b("_onTapStart",d.tagName+","+d.className),e=v._index(d),n=v._index(d,r.draggable),"function"==typeof g){if(g.call(this,t,d,this))return m._dispatchEvent(o,h,"filter",d,a,a,e,void 0,n),void(i&&t.cancelable&&t.preventDefault())}else if(g&&(g=g.split(",").some(function(t){if(t=s.closest(h,t.trim(),a,!1))return m._dispatchEvent(o,t,"filter",d,a,a,e,void 0,n),!0})))return void(i&&t.cancelable&&t.preventDefault());r.handle&&!s.closest(h,r.handle,a,!1)||this._prepareDragStart(t,c,d,e,n)}},_handleAutoScroll:function(t,e){if(m.dragEl&&this.options.scroll)return f._handleAutoScroll(t,this.options,e)},_prepareDragStart:function(t,e,n,o,a){var r,i=this,s=i.el,l=i.options,h=s.ownerDocument,g=m.dragEl;b("_prepareDragStart","start"),n&&!g&&n.parentNode===s&&(y=s,g=m.dragEl=n,E=g.parentNode,D=g.nextSibling,S=n,T=l.group,C=o,x=a,P={target:g,clientX:(e||t).clientX,clientY:(e||t).clientY},this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,g.style["will-change"]="all",g.style.transition="",g.style.transform="",r=function(){i._disableDelayedDragEvents(),!z&&i.nativeDraggable&&(g.draggable=!0),i._triggerDragStart(t,e),m._dispatchEvent(i,y,"choose",g,y,y,C,void 0,x),c.toggleClass(g,l.chosenClass,!0)},l.ignore.split(",").forEach(function(t){!function(t,e,n){if(t){var o=t.getElementsByTagName(e),a=0,r=o.length;if(n)for(;a<r;a++)n(o[a],a);return o}}(g,t.trim(),$)}),m.prepare(this),d.on(h,"mouseup",i._onDrop),z&&this.nativeDraggable&&(this.options.touchStartThreshold=4,g.draggable=!0),!l.delay||l.delayOnTouchOnly&&!e||this.nativeDraggable&&(U||q)?r():(d.on(h,"mouseup",i._disableDelayedDrag),d.on(h,"mousemove",i._delayedDragTouchMoveHandler),i._dragStartTimer=j(r,l.delay)))},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;max(abs(e.clientX-this._lastX),abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){m.dragEl&&$(m.dragEl),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;d.off(t,"mouseup",this._disableDelayedDrag),d.off(t,"mousemove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){b("_triggerDragStart","start"),b("_triggerDragStart","nativeDraggable is "+this.nativeDraggable),this.nativeDraggable?(d.on(m.dragEl,"dragend",this),d.on(y,"dragstart",this._onDragStart)):d.on(F,"mousemove",this._onTouchMove);try{F.selection?K(function(){F.selection.empty()}):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(t,e){B=!1;var n=m.dragEl;if(y&&n){this.nativeDraggable&&(d.on(F,"dragover",this._handleAutoScroll),d.on(F,"dragover",m._checkAlignment));var o=this.options;!t&&c.toggleClass(n,o.dragClass,!1),c.toggleClass(n,o.ghostClass,!0),c.css(n,"transform",""),m.active=this,t&&this._appendGhost(),m._dispatchEvent(this,y,"start",n,y,y,C,void 0,x,void 0,e)}else this._nulling()},_onTouchMove:function(t,e){b("_onTouchMove","start");var n=_.ghostEl;if(P){var o=this.options,a=o.fallbackTolerance,r=o.fallbackOffset,i=t.touches?t.touches[0]:t,s=n&&h.matrix(n),l=n&&s&&s.a,d=n&&s&&s.d,g=_.getRelativeScrollOffset(),u=(i.clientX-P.clientX+r.x)/(l||1)+(g?g[0]-ghostRelativeParentInitialScroll[0]:0)/(l||1),p=(i.clientY-P.clientY+r.y)/(d||1)+(g?g[1]-ghostRelativeParentInitialScroll[1]:0)/(d||1),f=t.touches?"translate3d("+u+"px,"+p+"px,0)":"translate("+u+"px,"+p+"px)";if(!m.active&&!B){if(a&&min(abs(i.clientX-this._lastX),abs(i.clientY-this._lastY))<a)return;this._onDragStart(t,!0)}!e&&this._handleAutoScroll(i,!0),A=!0,m.touchEvt=i,n&&(c.css(n,"webkitTransform",f),c.css(n,"mozTransform",f),c.css(n,"msTransform",f),c.css(n,"transform",f)),t.preventDefault()}},_appendGhost:function(){var t=this.options.fallbackOnBody?F.body:y;return _._appendGhost(m.dragEl,t,this.options)},_animate:function(t,e){var n=this.options.animation,o=m.dragEl;if(n){var a=l.boundingRect(e);if(e===o&&a,1===t.nodeType&&(t=l.boundingRect(t)),t.left+t.width/2!==a.left+a.width/2||t.top+t.height/2!==a.top+a.height/2){var r=h.matrix(this.el),i=r&&r.a,s=r&&r.d;c.css(e,"transition","none"),c.css(e,"transform","translate3d("+(t.left-a.left)/(i||1)+"px,"+(t.top-a.top)/(s||1)+"px,0)"),this._repaint(e),c.css(e,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),c.css(e,"transform","translate3d(0,0,0)")}"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=j(function(){c.css(e,"transition",""),c.css(e,"transform",""),e.animated=!1},n)}},_repaint:function(t){return t.offsetWidth},_offMoveEvents:function(){d.off(F,"dragover",m.nearestEmptyInsertDetectEvent),d.off(F,"mousemove",m.nearestEmptyInsertDetectEvent)},_offUpEvents:function(){var t=this.el.ownerDocument;d.off(t,"mouseup",this._onDrop),d.off(F,"selectstart",this)},_onDragStart:function(t,e){var n=this,o=m.dragEl,a=t.dataTransfer,r=n.options,s=m.cloneEl=i.clone(o,!0);s.draggable=!1,s.style["will-change"]="",this._hideClone(),c.toggleClass(s,n.options.chosenClass,!1),n._cloneId=K(function(){n.options.removeCloneOnHide||y.insertBefore(s,o),m._dispatchEvent(n,y,"clone",o)}),!e&&c.toggleClass(o,r.dragClass,!0),e?(X=!0,n._loopId=setInterval(m._emulateDragOver.bind(m),50)):(d.off(F,"mouseup",n._onDrop),a&&(a.effectAllowed="move",r.setData&&r.setData.call(n,a,o)),d.on(F,"drop",n),c.css(o,"transform","translateZ(0)")),B=!0,n._dragStartId=K(n._dragStarted.bind(n,e,t)),d.on(F,"selectstart",n),W&&c.css(F.body,"user-select","none")},_onDragOver:function(t){var e,n,o,a=this.el,r=t.target,i=this.options,d=i.group,h=m.active,g=T===d,u=i.sort,p=this,b=m.dragEl,S=m.putSortable;if(!_silent){if(void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),A=!0,r=s.closest(r,i.draggable,a,!0),b.contains(t.target)||r.animated)return J(!1);if(r!==b&&(X=!1),h&&!i.disabled&&(g?u||(o=!y.contains(b)):S===this||(this.lastPutMode=T.checkPull(this,h,b,t))&&d.checkPut(this,h,b,t))){var k=this._getDirection(t,r);if(e=l.boundingRect(b),o)return this._hideClone(),E=y,D?y.insertBefore(b,D):y.appendChild(b),J(!0);var w=_._lastChild(a);if(!w||_._ghostIsLast(t,k,a)&&!w.animated){if(w&&a===t.target&&(r=w),r&&(n=l.boundingRect(r)),g?h._hideClone():h._showClone(this),!1!==m._onMove(y,a,b,e,r,n,t,!!r))return a.appendChild(b),E=a,null,K(),J(!0)}else if(r&&r!==b&&r.parentNode===a){var I,P=0,B=r.sortableMouseAligned,G=b.parentNode!==a,L="vertical"===k?"top":"left",q=f._isScrolledPast(r,"top")||f._isScrolledPast(b,"top"),U=q?q.scrollTop:void 0;if(M!==r&&(O=null,I=l.boundingRect(r)[L],Y=!1),v._isElInRowColumn(b,r,k)&&B||G||q||i.invertSwap||"insert"===O||"swap"===O?("swap"!==O&&(H=i.invertSwap||G),P=function(t,e,n,o,a,r,i){var s=l.boundingRect(e),c="vertical"===n?t.clientY:t.clientX,d="vertical"===n?s.height:s.width,h="vertical"===n?s.top:s.left,g="vertical"===n?s.bottom:s.right,u=l.boundingRect(b),p=!1;if(!r)if(i&&R<d*o){if(!Y&&(1===N?c>h+d*a/2:c<g-d*a/2)&&(Y=!0),Y)p=!0;else if("vertical"===n?u.top:u.left,"vertical"===n?u.bottom:u.right,1===N?c<h+R:c>g-R)return-1*N}else if(c>h+d*(1-o)/2&&c<g-d*(1-o)/2)return Q(e);return(p=p||r)&&(c<h+d*a/2||c>g-d*a/2)?c>h+d/2?1:-1:0}(t,r,k,i.swapThreshold,null==i.invertedSwapThreshold?i.swapThreshold:i.invertedSwapThreshold,H,M===r),O="swap"):(P=Q(r),O="insert"),0===P)return J(!1);null,M=r,N=P,n=l.boundingRect(r);var z=r.nextElementSibling,W=!1;W=1===P;var Z=m._onMove(y,a,b,e,r,n,t,W);if(!1!==Z)return 1!==Z&&-1!==Z||(W=1===Z),_silent=!0,j(tt,30),g?h._hideClone():h._showClone(this),W&&!z?a.appendChild(b):r.parentNode.insertBefore(b,W?z:r),q&&l.scrollBy(q,0,U-q.scrollTop),E=b.parentNode,void 0===I||H||(R=abs(I-l.boundingRect(r)[L])),K(),J(!0)}if(a.contains(b))return J(!1)}return!1}function J(o){return o&&(g?h._hideClone():h._showClone(p),h&&(c.toggleClass(b,S?S.options.ghostClass:h.options.ghostClass,!1),c.toggleClass(b,i.ghostClass,!0)),S!==p&&p!==m.active?S=m.putSortable=p:p===m.active&&(S=m.putSortable=null),e&&p._animate(e,b),r&&n&&p._animate(n,r)),(r===b&&!b.animated||r===a&&!r.animated)&&(M=null),i.dragoverBubble||t.rootEl||r===F||(p._handleAutoScroll(t),b.parentNode[m.expando]._computeIsAligned(t),!o&&m.nearestEmptyInsertDetectEvent(t)),!i.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),!0}function K(){m._dispatchEvent(p,y,"change",r,a,y,C,v._index(b),x,v._index(b,i.draggable),t)}function Q(t){return v._index(b)<v._index(t)?1:-1}},_onDrop:function(t){var e=this.el,n=this.options,o=m.dragEl,a=m.putSortable;B=!1,scrolling=!1,H=!1,Y=!1,clearInterval(this._loopId),clearInterval(I),f._clearAutoScrolls(),f._cancelThrottle(),clearTimeout(this._dragStartTimer),Q(this._cloneId),Q(this._dragStartId),d.off(F,"mousemove",this._onTouchMove),this.nativeDraggable&&(d.off(F,"drop",this),d.off(e,"dragstart",this._onDragStart),d.off(F,"dragover",this._handleAutoScroll),d.off(F,"dragover",m._checkAlignment)),W&&c.css(F.body,"user-select",""),this._offMoveEvents(),this._offUpEvents(),t&&(A&&(t.cancelable&&t.preventDefault(),!n.dropBubble&&t.stopPropagation()),_.ghostEl&&_.ghostEl.parentNode&&_.ghostEl.parentNode.removeChild(_.ghostEl),(y===E||a&&"clone"!==a.lastPutMode)&&m.cloneEl&&m.cloneEl.parentNode&&m.cloneEl.parentNode.removeChild(m.cloneEl),o&&(this.nativeDraggable&&d.off(o,"dragend",this),$(o),o.style["will-change"]="",c.toggleClass(o,a?a.options.ghostClass:this.options.ghostClass,!1),c.toggleClass(o,this.options.chosenClass,!1),m._dispatchEvent(this,y,"unchoose",o,E,y,C,null,x,null,t),y!==E?(k=v._index(o),w=v._index(o,n.draggable),k>=0&&(m._dispatchEvent(null,E,"add",o,E,y,C,k,x,w,t),m._dispatchEvent(this,y,"remove",o,E,y,C,k,x,w,t),m._dispatchEvent(null,E,"sort",o,E,y,C,k,x,w,t),m._dispatchEvent(this,y,"sort",o,E,y,C,k,x,w,t)),a&&a.save()):o.nextSibling!==D&&(k=v._index(o),w=v._index(o,n.draggable),k>=0&&(m._dispatchEvent(this,y,"update",o,E,y,C,k,x,w,t),m._dispatchEvent(this,y,"sort",o,E,y,C,k,x,w,t))),m.active&&(null!=k&&-1!==k||(k=C,w=x),m._dispatchEvent(this,y,"end",o,E,y,C,k,x,w,t),this.save()))),this._nulling()},_nulling:function(){y=m.dragEl=E=_.ghostEl=D=m.cloneEl=S=f.scrollParentEl=f.autoScrolls.length=I=P=m.touchEvt=A=k=C=M=N=m.putSortable=T=m.active=null,savedInputChecked.forEach(function(t){t.checked=!0}),savedInputChecked.length=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":m.dragEl&&(this._onDragOver(t),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move");t.cancelable&&t.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var t,e=[],n=this.el.children,o=0,a=n.length,r=this.options;o<a;o++)t=n[o],s.closest(t,r.draggable,this.el,!1)&&e.push(t.getAttribute(r.dataIdAttr)||J(t));return e},sort:function(t){var e={},n=this.el;this.toArray().forEach(function(t,o){var a=n.children[o];s.closest(a,this.options.draggable,n,!1)&&(e[t]=a)},this),t.forEach(function(t){e[t]&&(n.removeChild(e[t]),n.appendChild(e[t]))})},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return s.closest(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var n=this.options;if(void 0===e)return n[t];n[t]=e,"group"===t&&_prepareGroup(n)},destroy:function(){var t=this.el;t[m.expando]=null,d.off(t,"mousedown",this._onTapStart),this.nativeDraggable&&(d.off(t,"dragover",this),d.off(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),m.sortables.splice(m.sortables.indexOf(this.el),1),this.el=t=null},_hideClone:function(){m.cloneEl.cloneHidden||(c.css(m.cloneEl,"display","none"),m.cloneEl.cloneHidden=!0,m.cloneEl.parentNode&&this.options.removeCloneOnHide&&m.cloneEl.parentNode.removeChild(m.cloneEl))},_showClone:function(t){"clone"===t.lastPutMode?m.cloneEl.cloneHidden&&(y.contains(m.dragEl)&&!this.options.group.revertClone?y.insertBefore(m.cloneEl,m.dragEl):D?y.insertBefore(m.cloneEl,D):y.appendChild(m.cloneEl),this.options.group.revertClone&&this._animate(m.dragEl,m.cloneEl),c.css(m.cloneEl,"display",""),m.cloneEl.cloneHidden=!1):this._hideClone()}},V.create=function(t,e){return new V(t,e)},V.version="1.9.0",t.attach("intg.Sortable",V)});
//# sourceMappingURL=sourcemaps/Sortable.js.map
