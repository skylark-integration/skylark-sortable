/**
 * skylark-sortable - A version of sortable.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sortable/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-langx-hoster/isBrowser","skylark-langx-hoster/isMobile","skylark-domx-query","skylark-domx-browser","skylark-domx-noder","skylark-domx-finder","skylark-domx-geom","skylark-domx-styler","skylark-domx-eventer","skylark-domx-transforms","skylark-domx-scrolls/scrollingElement","skylark-domx-layouts/oriented","skylark-devices-points/touch","./autoscroll","./ghoster"],function(t,e,o,n,l,r,a,i,s,c,d,u,g,h,v,m,f){"use strict";var p="Sortable"+(new Date).getTime(),E={log:function(t,e){l("#console").append("<div>"+t+":"+e+"</div>")},expando:p,activeGroup:null,active:null,putSortable:null,sortables:[],dragEl:null,cloneEl:null,ignoreNextClick:!1,awaitingDragStarted:!1,touchEvt:null,prepare:function(t){this.draggable=t,t.nativeDraggable||(d.on(document,"mousemove",this._onTouchMove),d.on(document,"mouseup",function(t){d.off(document,"mousemove",this._onTouchMove),E.putSortable&&E.putSortable._onDrop(t),E.draggable&&E.draggable._onDragEnd(t),f.remove(),E._loopId&&clearInterval(E._loopId),E._loopId=null}))},start:function(t,e){this.draggable=t;var o=t.elm().ownerDocument;d.on(o,"dragover",this.nearestEmptyInsertDetectEvent),d.on(o,"mousemove",this.nearestEmptyInsertDetectEvent),this.draggable.nativeDraggable?(d.on(document,"dragover",this._handleAutoScroll),d.on(document,"dragover",this._checkAlignment)):d.on(document,"mousemove",this._onTouchMove)},over:function(t){this._handleAutoScroll(t)},end:function(t){d.off(document,"dragover",this.nearestEmptyInsertDetectEvent),d.off(document,"mousemove",this.nearestEmptyInsertDetectEvent),this.draggable.nativeDraggable?(d.off(document,"dragover",this._handleAutoScroll),d.off(document,"dragover",this._checkAlignment)):d.off(document,"mousemove",this._onTouchMove),this.draggable=null,this._nulling()},nearestEmptyInsertDetectEvent:function(t){if(E.dragEl){t=t.touches?t.touches[0]:t;var e=E._detectNearestEmptySortable(t.clientX,t.clientY);if(e){var o={};for(var n in t)o[n]=t[n];o.target=o.rootEl=e,o.preventDefault=void 0,o.stopPropagation=void 0,e[p]._onDragOver(o)}}},_detectNearestEmptySortable:function(t,e){for(var o=this.sortables,n=0;n<o.length;n++)if(!i.lastChild(o[n],{ignoreHidden:!0,excluding:[this.ghostEl]})){var l=s.boundingRect(o[n]),r=o[n][p].options.emptyInsertThreshold,a=t>=l.left-r&&t<=l.right+r,c=e>=l.top-r&&e<=l.bottom+r;if(r&&a&&c)return o[n]}},_checkAlignment:function(t){this.dragEl&&this.dragEl.parentNode&&this.dragEl.parentNode[p]&&this.dragEl.parentNode[p]._computeIsAligned(t)},_emulateDragOver:function(t){var e=this.dragEl,o=this.touchEvt;if(o){if(this._lastX===o.clientX&&this._lastY===o.clientY&&!t)return;this._lastX=o.clientX,this._lastY=o.clientY;for(var n=document.elementFromPoint(o.clientX,o.clientY),l=n;n&&n.shadowRoot&&(n=n.shadowRoot.elementFromPoint(o.clientX,o.clientY))!==l;)l=n;if(l)do{if(l[p])if(l[p]._onDragOver({clientX:o.clientX,clientY:o.clientY,target:n,rootEl:l}))break;n=l}while(l=l.parentNode);e.parentNode[p]._computeIsAligned(o)}},_onMove:function(t,e,o,n,l,r,a,i){var c,u,g=t[p],h=g.options.onMove;return c=d.create("move",{to:e,from:t,dragged:o,draggedRect:n,related:l||e,relatedRect:r||s.boundingRect(e),willInsertAfter:i,originalEvent:a}),t.dispatchEvent(c),h&&(u=h.call(g,c,a)),u},_dispatchEvent:function(t,e,o,n,l,r,a,i,s,c,u){var g,h=(t=t||e[p]).options,v="on"+o.charAt(0).toUpperCase()+o.substr(1),m=this.putSortable;g=d.create(o,{to:l||e,from:r||e,item:n||e,clone:this.cloneEl,oldIndex:a,newIndex:i,oldDraggableIndex:s,newDraggableIndex:c,originalEvent:u,pullMode:m?m.lastPutMode:void 0}),e&&e.dispatchEvent(g),h[v]&&h[v].call(t,g)},_disableDraggable:function(t){t.draggable=!1},_handleAutoScroll:function(t,e){if(E.dragEl&&E.draggable.options.scroll)return m._handleAutoScroll(t,E.draggable.options,e)},_onTouchMove:function(t,e){var o=f.ghostEl,n=E.draggable,l=E.tapEvt;if(l){var r=n.options,a=r.fallbackTolerance,i=r.fallbackOffset,s=t.touches?t.touches[0]:t,d=o&&u.matrix(o),g=o&&d&&d.a,h=o&&d&&d.d,v=f.getRelativeScrollOffset(),m=(s.clientX-l.clientX+i.x)/(g||1)+(v?v[0]-ghostRelativeParentInitialScroll[0]:0)/(g||1),p=(s.clientY-l.clientY+i.y)/(h||1)+(v?v[1]-ghostRelativeParentInitialScroll[1]:0)/(h||1),b=t.touches?"translate3d("+m+"px,"+p+"px,0)":"translate("+m+"px,"+p+"px)";if(!E.active&&!E.awaitingDragStarted){if(a&&Math.min(Math.abs(s.clientX-n._lastX),Math.abs(s.clientY-n._lastY))<a)return;n._onDragStart(t,!0),E.ignoreNextClick=!0,E._loopId=setInterval(E._emulateDragOver.bind(E),50)}!e&&E._handleAutoScroll(s,!0),E.touchEvt=s,o&&c.css(o,"transform",b),t.preventDefault()}},_nulling:function(){E.rootEl=E.dragEl=E.parentEl=E.nextEl=E.cloneEl=m.scrollEl=m.scrollParentEl=m.autoScrolls.length=E.tapEvt=E.touchEvt=E.oldIndex=E.putSortable=E.activeGroup=E.active=null}};return E});
//# sourceMappingURL=sourcemaps/dnd.js.map
